<!DOCTYPE html>
<html lang="en" style="color-scheme: light dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f6f8fa">
    <title>Vibe Coding Workshop - Doc Viewer</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root,
        [data-theme="light"] {
            --bg-color: #f6f8fa;
            --surface-color: #ffffff;
            --text-color: #24292f;
            --text-muted: #57606a;
            --border-color: #d0d7de;
            --primary-color: #0969da;
            --code-bg: #f6f8fa;
            --header-border: #d8dee4;
            --table-alt-bg: #f6f8fa;
            --blockquote-border: #d0d7de;
            --error-bg: #fff8c5;
            --error-border: rgba(234,179,8,0.4);
            --sidebar-active-bg: rgba(9,105,218,0.08);
            --wizard-gradient-start: var(--primary-color);
            --wizard-gradient-end: #8b5cf6;
            --wizard-btn-gradient-start: var(--primary-color);
            --wizard-btn-gradient-end: #2563eb;
            --wizard-btn-gradient-hover-end: #1d4ed8;
            --wizard-pulse-color: rgba(9,105,218,0.2);
            --wizard-pulse-color-faint: rgba(9,105,218,0.1);
            --wizard-bar-shadow: rgba(0,0,0,0.06);
            --wizard-btn-shadow: rgba(9,105,218,0.25);
            --wizard-btn-shadow-hover: rgba(9,105,218,0.3);
        }

        [data-theme="dark"] {
            --bg-color: #0d1117;
            --surface-color: #161b22;
            --text-color: #e6edf3;
            --text-muted: #8b949e;
            --border-color: #30363d;
            --primary-color: #58a6ff;
            --code-bg: #161b22;
            --header-border: #21262d;
            --table-alt-bg: #161b22;
            --blockquote-border: #30363d;
            --error-bg: #2d1b00;
            --error-border: rgba(187,128,9,0.4);
            --sidebar-active-bg: rgba(88,166,255,0.1);
            --wizard-gradient-start: #58a6ff;
            --wizard-gradient-end: #a78bfa;
            --wizard-btn-gradient-start: #58a6ff;
            --wizard-btn-gradient-end: #3b82f6;
            --wizard-btn-gradient-hover-end: #2563eb;
            --wizard-pulse-color: rgba(88,166,255,0.2);
            --wizard-pulse-color-faint: rgba(88,166,255,0.1);
            --wizard-bar-shadow: rgba(0,0,0,0.2);
            --wizard-btn-shadow: rgba(88,166,255,0.25);
            --wizard-btn-shadow-hover: rgba(88,166,255,0.35);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
            padding: 20px;
        }

        /* Top Bar for Navigation */
        .top-bar {
            max-width: 1440px;
            margin: 0 auto 20px auto;
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            gap: 8px;
            background: var(--surface-color);
            padding: 10px 20px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }

        .logo {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-color);
            margin-right: auto;
            white-space: nowrap;
        }


        .top-bar-global {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }

        .top-bar-doc {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 1;
            min-width: 0;
        }

        .top-bar-buttons {
            flex-shrink: 0;
            order: 1;
        }

        .top-bar-row2 {
            display: contents;
        }

        .top-bar-global {
            order: 2;
        }

        select {
            padding: 6px 12px;
            font-size: 14px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            color: var(--text-color);
            cursor: pointer;
            min-width: 180px;
        }

        select:hover {
            border-color: #b1b9c0;
        }

        /* Sidebar — fixed to the left of the centered 1280px content column */
        .layout-wrapper {
            max-width: 1440px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .sidebar {
            display: block;
            position: sticky;
            top: 20px;
            width: 220px;
            flex-shrink: 0;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 16px 0;
            scrollbar-width: thin;
            z-index: 50;
        }

        .sidebar::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .sidebar-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            padding: 0 16px 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-collapse-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            padding: 2px;
            line-height: 1;
            font-size: 16px;
            border-radius: 4px;
            transition: color 0.15s, background 0.15s;
        }

        .sidebar-collapse-btn:hover {
            color: var(--text-color);
            background: var(--sidebar-active-bg);
        }

        .sidebar.collapsed {
            display: none;
        }

        .sidebar-reopen {
            display: flex;
            width: 28px;
            height: 28px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: color 0.15s;
            flex-shrink: 0;
            padding: 0;
            margin-left: -10px;
        }

        .sidebar-reopen:hover {
            color: var(--text-color);
        }

        .sidebar-docs-nav {
            padding: 0;
            margin: 0;
            list-style: none;
        }

        .sidebar-docs-group-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted);
            padding: 10px 16px 4px;
        }

        .sidebar-docs-nav a {
            display: block;
            padding: 4px 16px;
            font-size: 12px;
            color: var(--text-muted);
            text-decoration: none;
            border-left: 2px solid transparent;
            transition: color 0.15s, background 0.15s, border-color 0.15s;
            line-height: 1.4;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-docs-nav a:hover {
            color: var(--text-color);
            background: var(--sidebar-active-bg);
        }

        .sidebar-docs-nav a.active {
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            font-weight: 500;
        }

        /* Main Container */
        .container {
            flex: 1;
            min-width: 0;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 48px;
            min-height: 80vh;
        }

        /* Font size classes */
        #markdown-content.font-small { font-size: 16px; }
        #markdown-content.font-default { font-size: 18px; }
        #markdown-content.font-large { font-size: 20px; }
        #markdown-content.font-xlarge { font-size: 22px; }
        #markdown-content.font-xxlarge { font-size: 24px; }

        /* Markdown Standard Styling (GitHub-like) */
        #markdown-content h1 {
            border-bottom: 1px solid var(--header-border);
            padding-bottom: 0.3em;
            font-size: 2em;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }

        #markdown-content h1:first-child {
            margin-top: 0;
        }

        #markdown-content h2 {
            border-bottom: 1px solid var(--header-border);
            padding-bottom: 0.3em;
            font-size: 1.5em;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
            scroll-margin-top: 80px;
        }

        #markdown-content h3 {
            font-size: 1.25em;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
            scroll-margin-top: 80px;
        }

        #markdown-content h4 {
            font-size: 1.125em;
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }

        #markdown-content p {
            margin-top: 0;
            margin-bottom: 16px;
        }

        #markdown-content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        #markdown-content a:hover {
            text-decoration: underline;
        }

        #markdown-content code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(175,184,193,0.2);
            border-radius: 6px;
            font-family: ui-monospace,SFMono-Regular,SF Mono,Menlo,Consolas,Liberation Mono,monospace;
        }

        #markdown-content pre {
            position: relative;
            background-color: var(--code-bg);
            border-radius: 6px;
            font-size: 85%;
            line-height: 1.45;
            overflow: auto;
            padding: 16px;
            margin-top: 0;
            margin-bottom: 16px;
        }

        #markdown-content pre code {
            background-color: transparent;
            padding: 0;
            margin: 0;
            font-size: 100%;
            word-break: normal;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 0;
            border-radius: 0;
        }

        /* Code block copy button */
        .code-copy-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            padding: 4px 10px;
            font-size: 11px;
            font-family: inherit;
            color: var(--text-muted);
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.15s, background 0.1s;
        }

        #markdown-content pre:hover .code-copy-btn {
            opacity: 0.85;
        }

        .code-copy-btn:hover {
            background: var(--bg-color);
            color: var(--text-color);
            opacity: 1 !important;
        }

        .code-copy-btn.copied {
            color: #22863a;
            opacity: 1 !important;
        }


        #markdown-content blockquote {
            padding: 0 1em;
            color: var(--text-muted);
            border-left: 0.25em solid var(--blockquote-border);
            margin: 0 0 16px 0;
        }

        #markdown-content ul, #markdown-content ol {
            padding-left: 2em;
            margin-top: 0;
            margin-bottom: 16px;
        }

        #markdown-content table {
            border-spacing: 0;
            border-collapse: collapse;
            display: block;
            margin-top: 0;
            margin-bottom: 16px;
            width: max-content;
            max-width: 100%;
            overflow: auto;
        }

        #markdown-content tr {
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
        }

        #markdown-content tr:nth-child(2n) {
            background-color: var(--table-alt-bg);
        }

        #markdown-content th, #markdown-content td {
            padding: 6px 13px;
            border: 1px solid var(--border-color);
        }

        #markdown-content th {
            font-weight: 600;
        }

        #markdown-content img {
            max-width: 100%;
            box-sizing: border-box;
            background-color: var(--surface-color);
        }

        /* Two-Column Auto-Balanced Layout */
        .two-column {
            column-count: 2;
            column-gap: 32px;
        }

        .two-column p {
            break-inside: avoid;
            margin-bottom: 12px;
        }

        /* Loading & Error States */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .error {
            padding: 20px;
            background-color: var(--error-bg);
            border: 1px solid var(--error-border);
            border-radius: 6px;
            color: var(--text-color);
            margin-bottom: 20px;
        }

        .file-upload {
            margin-top: 20px;
            padding: 20px;
            border: 2px dashed var(--border-color);
            border-radius: 6px;
            text-align: center;
        }

        .top-bar-btn {
            padding: 6px 12px;
            background-color: var(--surface-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .top-bar-btn:hover {
            background-color: var(--bg-color);
        }

        .top-bar-btn svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        /* Font size button */
        #font-size-toggle {
            font-weight: 700;
            font-size: 14px;
            min-width: 34px;
            justify-content: center;
        }

        #font-size-toggle .size-indicator {
            font-size: 9px;
            font-weight: 500;
            color: var(--text-muted);
            margin-left: 1px;
        }

        /* Collapsible Sections */
        #markdown-content .collapsible-header {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-left: 1.2em;
        }

        #markdown-content .collapsible-header::before {
            content: '';
            display: inline-block;
            border-style: solid;
            border-width: 5px 0 5px 8px;
            border-color: transparent transparent transparent var(--text-muted);
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%) rotate(90deg);
            transition: transform 0.2s ease;
        }

        #markdown-content .collapsible-header.collapsed::before {
            transform: translateY(-50%) rotate(0deg);
        }

        .section-content.collapsed {
            display: none;
        }

        /* Nested h3 sections: indent and add left border for hierarchy */
        #markdown-content h3.collapsible-header {
            margin-left: 1.2em;
            padding-left: 1.4em;
            border-left: 2px solid var(--border-color);
        }

        #markdown-content h3.collapsible-header::before {
            left: 0.6em;
        }

        /* Document Navigation */
        .doc-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 32px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .doc-nav a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            padding: 8px 14px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: border-color 0.15s, background-color 0.15s;
        }

        .doc-nav a:hover {
            border-color: var(--primary-color);
            background-color: var(--bg-color);
            text-decoration: none;
        }

        .doc-nav .nav-prev::before {
            content: '← ';
        }

        .doc-nav .nav-next::after {
            content: ' →';
        }

        .doc-nav .nav-spacer {
            flex: 1;
        }

        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 40px;
            height: 40px;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            background: var(--surface-color);
            color: var(--text-color);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s, background 0.15s;
            z-index: 90;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: var(--bg-color);
        }

        /* TOC FAB (mobile) */
        .toc-fab {
            display: none;
            position: fixed;
            bottom: 72px;
            right: 24px;
            width: 44px;
            height: 44px;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            background: var(--surface-color);
            color: var(--text-color);
            cursor: pointer;
            align-items: center;
            justify-content: center;
            z-index: 100;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
        }

        .toc-fab svg {
            width: 20px;
            height: 20px;
        }

        /* Sidebar overlay (mobile) */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 199;
        }

        .sidebar-overlay.active {
            display: block;
        }

        /* Mobile: sidebar becomes off-screen drawer */
        @media (max-width: 900px) {
            .sidebar {
                display: none;
                position: fixed;
                top: 0;
                left: -300px;
                width: 280px;
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                border: none;
                border-right: 1px solid var(--border-color);
                z-index: 200;
                transition: left 0.25s ease;
                padding-top: 20px;
            }

            .sidebar.mobile-open {
                display: block;
                left: 0;
            }

            .toc-fab {
                display: flex;
            }

            .sidebar-reopen {
                display: none;
            }
        }

        /* Compact top nav */
        @media (max-width: 980px) {
            .top-bar { flex-wrap: wrap; }

            /* Row 2: selector + buttons together on their own line */
            .top-bar-row2 {
                display: flex;
                order: 1;
                flex: 1 1 100%;
                gap: 8px;
                align-items: center;
            }

            .top-bar-row2 .top-bar-doc:not(.top-bar-buttons) { flex: 1; min-width: 0; }

            /* Keep GitHub/theme on row 1 with logo */
            .top-bar-global { order: 0; }

            select {
                min-width: 0;
                flex: 1;
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px;
            }

            .two-column {
                column-count: 1;
            }

            #markdown-content td[width] {
                display: block;
                width: 100% !important;
                border-top: none;
            }

            #markdown-content td[width] img {
                display: block;
                margin: 8px auto;
            }

            #markdown-content td[width] a {
                word-break: break-all;
            }

            #markdown-content h1 {
                font-size: 1.5em;
            }

            #markdown-content h2 {
                font-size: 1.25em;
            }
        }

        /* ── Wizard / Step-by-Step Mode ─────────────────────────── */
        .wizard-toggle {
            display: none; /* shown via JS when doc has wizard markers */
            padding: 5px 16px;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.02em;
            border: 1.5px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-color);
            color: var(--text-muted);
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.25s cubic-bezier(0.4, 0, 0.2, 1), color 0.25s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.25s cubic-bezier(0.4, 0, 0.2, 1), transform 0.25s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .wizard-toggle::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--wizard-gradient-start), var(--wizard-gradient-end));
            opacity: 0;
            transition: opacity 0.25s;
            border-radius: inherit;
        }

        .wizard-toggle:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(9,105,218,0.15);
        }

        .wizard-toggle.active {
            border-color: transparent;
            color: #fff;
        }

        .wizard-toggle.active::before {
            opacity: 1;
        }

        .wizard-toggle span {
            position: relative;
            z-index: 1;
        }

        .wizard-bar {
            display: none;
            max-width: 1440px;
            margin: 0 auto 20px auto;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 14px 20px;
            align-items: center;
            gap: 16px;
            box-shadow: 0 2px 12px var(--wizard-bar-shadow);
            animation: wizardBarSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes wizardBarSlideIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .wizard-bar.active {
            display: flex;
        }

        .wizard-step-counter {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 120px;
            letter-spacing: -0.01em;
        }

        .wizard-step-counter .step-number {
            color: var(--primary-color);
            font-variant-numeric: tabular-nums;
        }

        .wizard-progress {
            display: flex;
            align-items: center;
            gap: 0;
            flex: 1;
            justify-content: center;
            overflow-x: auto;
            padding: 4px 0;
            position: relative;
        }

        .wizard-progress-track {
            display: flex;
            align-items: center;
            gap: 0;
            position: relative;
            padding: 4px 0;
        }

        .wizard-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-color);
            flex-shrink: 0;
            transition: background 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            z-index: 1;
            border: 2px solid var(--surface-color);
            box-shadow: 0 0 0 1px var(--border-color);
        }

        .wizard-dot:hover {
            transform: scale(1.35);
            box-shadow: 0 0 0 1px var(--primary-color), 0 2px 8px rgba(9,105,218,0.2);
        }

        .wizard-dot.completed {
            background: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-color);
        }

        .wizard-dot.current {
            background: var(--primary-color);
            transform: scale(1.4);
            box-shadow: 0 0 0 3px var(--wizard-pulse-color), 0 0 0 1px var(--primary-color);
            animation: wizardPulse 2s ease-in-out infinite;
        }

        @keyframes wizardPulse {
            0%, 100% { box-shadow: 0 0 0 3px var(--wizard-pulse-color), 0 0 0 1px var(--primary-color); }
            50% { box-shadow: 0 0 0 5px var(--wizard-pulse-color-faint), 0 0 0 1px var(--primary-color); }
        }

        .wizard-connector {
            width: 16px;
            height: 3px;
            background: var(--border-color);
            flex-shrink: 0;
            transition: background 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
        }

        .wizard-connector.filled {
            background: var(--primary-color);
        }

        .wizard-nav-btn {
            padding: 8px 20px;
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 0.02em;
            border: 1.5px solid var(--border-color);
            border-radius: 8px;
            background: var(--surface-color);
            color: var(--text-color);
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.2s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.2s cubic-bezier(0.4, 0, 0.2, 1), transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .wizard-nav-btn:hover:not(:disabled) {
            border-color: var(--primary-color);
            background: var(--bg-color);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }

        .wizard-nav-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: none;
        }

        .wizard-nav-btn:disabled {
            opacity: 0.3;
            cursor: default;
        }

        .wizard-nav-btn.primary {
            background: linear-gradient(135deg, var(--wizard-btn-gradient-start), var(--wizard-btn-gradient-end));
            color: #fff;
            border-color: transparent;
            box-shadow: 0 2px 8px var(--wizard-btn-shadow);
        }

        .wizard-nav-btn.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--wizard-btn-gradient-start), var(--wizard-btn-gradient-hover-end));
            border-color: transparent;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--wizard-btn-shadow-hover);
        }

        .wizard-nav-btn.primary:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 1px 4px var(--wizard-btn-shadow);
        }

        /* Wizard step content transition */
        .wizard-step-enter {
            animation: wizardStepIn 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes wizardStepIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 600px) {
            .wizard-bar {
                flex-wrap: wrap;
                gap: 10px;
                padding: 12px 14px;
                border-radius: 8px;
            }
            .wizard-progress {
                order: 3;
                flex-basis: 100%;
                justify-content: flex-start;
            }
            .wizard-step-counter {
                flex: 1;
                font-size: 13px;
            }
            .wizard-nav-btn {
                padding: 8px 16px;
                font-size: 13px;
            }
            .wizard-connector {
                width: 10px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .wizard-step-enter,
            .wizard-bar,
            .wizard-dot,
            .wizard-dot.current {
                animation: none !important;
            }
            .wizard-toggle,
            .wizard-nav-btn,
            .wizard-dot,
            .wizard-connector {
                transition-duration: 0.01ms !important;
            }
        }

        .skip-link {
            position: absolute;
            top: -100px;
            left: 0;
            background: var(--primary-color);
            color: #fff;
            padding: 8px 16px;
            z-index: 10000;
            font-weight: 600;
            border-radius: 0 0 6px 0;
            text-decoration: none;
        }

        .skip-link:focus {
            top: 0;
        }

        /* ── Pick Your Path ───────────────────────────────────── */
        .path-picker {
            max-width: 900px;
            margin: 0 auto;
        }

        .path-picker h1 {
            text-align: center;
            margin-bottom: 8px;
            font-size: 2em;
            font-weight: 700;
            border: none;
        }

        .path-picker .path-picker-subtitle {
            text-align: center;
            color: var(--text-muted);
            font-size: 1.05em;
            margin-bottom: 32px;
        }

        .path-picker-level {
            margin-bottom: 28px;
        }

        .path-picker-level-label {
            font-size: 0.8em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .path-picker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
        }

        .path-card {
            position: relative;
            background: var(--surface-color);
            border: 1.5px solid var(--border-color);
            border-radius: 12px;
            padding: 24px 20px 20px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .path-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            border-color: var(--primary-color);
        }

        .path-card-icon {
            font-size: 2em;
            line-height: 1;
            margin-bottom: 4px;
        }

        .path-card-name {
            font-size: 1.15em;
            font-weight: 700;
            color: var(--text-color);
        }

        .path-card-tools {
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .path-card-desc {
            font-size: 0.88em;
            color: var(--text-muted);
            line-height: 1.45;
            flex: 1;
        }

        .path-card-pills {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .path-pill {
            font-size: 0.75em;
            font-weight: 600;
            padding: 2px 10px;
            border-radius: 999px;
            letter-spacing: 0.02em;
        }

        .path-pill.time {
            background: rgba(100,100,100,0.1);
            color: var(--text-muted);
        }

        .path-pill.free {
            background: rgba(22,163,74,0.12);
            color: #16a34a;
        }

        .path-pill.paid {
            background: rgba(217,119,6,0.12);
            color: #d97706;
        }

        .path-card-badge {
            position: absolute;
            top: -10px;
            right: 16px;
            font-size: 0.7em;
            font-weight: 700;
            padding: 3px 10px;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--wizard-gradient-start), var(--wizard-gradient-end));
            color: #fff;
            letter-spacing: 0.03em;
        }

        .path-picker-hint {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9em;
            margin-top: 8px;
        }

        @media (max-width: 600px) {
            .path-picker-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ── Visual Step Components ─────────────────────────────────── */

        /* Callout boxes — replaces plain blockquotes */
        .step-callout {
            display: flex;
            gap: 12px;
            padding: 14px 18px;
            border-radius: 8px;
            border-left: 4px solid;
            margin: 0 0 16px 0;
            line-height: 1.55;
            color: var(--text-color);
        }

        .step-callout-icon {
            flex-shrink: 0;
            font-size: 1.2em;
            line-height: 1.5;
        }

        .step-callout-body {
            flex: 1;
            min-width: 0;
        }

        .step-callout-body p:last-child { margin-bottom: 0; }

        .step-callout.tip {
            background: rgba(9,105,218,0.06);
            border-color: var(--primary-color);
        }
        [data-theme="dark"] .step-callout.tip {
            background: rgba(88,166,255,0.08);
        }

        .step-callout.warning {
            background: rgba(217,119,6,0.07);
            border-color: #d97706;
        }
        [data-theme="dark"] .step-callout.warning {
            background: rgba(217,119,6,0.1);
        }

        .step-callout.note {
            background: rgba(22,163,74,0.06);
            border-color: #16a34a;
        }
        [data-theme="dark"] .step-callout.note {
            background: rgba(22,163,74,0.1);
        }

        /* Code snippet blocks */
        .step-terminal {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .step-terminal-bar { display: none; }

        .step-terminal pre {
            margin: 0 !important;
            border-radius: 0 !important;
            background: transparent !important;
            border: none;
        }

        .step-terminal pre code {
            color: var(--text-color);
        }

        /* CTA link buttons */
        .step-link-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--wizard-btn-gradient-start), var(--wizard-btn-gradient-end));
            color: #fff !important;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95em;
            text-decoration: none !important;
            transition: transform 0.15s, box-shadow 0.15s;
            box-shadow: 0 2px 8px var(--wizard-btn-shadow);
            margin: 4px 0;
        }

        .step-link-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--wizard-btn-shadow-hover);
            text-decoration: none !important;
        }

        /* Checklist (✅/❌ items) */
        .step-checklist {
            list-style: none !important;
            padding-left: 0 !important;
        }

        .step-checklist li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 6px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .step-checklist li:last-child {
            border-bottom: none;
        }

        .step-checklist-icon {
            flex-shrink: 0;
            font-size: 1.1em;
            line-height: 1.5;
        }

        /* Numbered steps (short ordered lists) */
        .step-num-list {
            list-style: none !important;
            padding-left: 0 !important;
            counter-reset: step-counter;
        }

        .step-num-list > li {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 10px 0;
            counter-increment: step-counter;
        }

        .step-num-list > li::before {
            content: counter(step-counter);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--wizard-gradient-start), var(--wizard-gradient-end));
            color: #fff;
            font-weight: 700;
            font-size: 0.85em;
            line-height: 1;
        }

        @media print {
            .step-callout { border: 1px solid #ddd; break-inside: avoid; }
            .step-terminal { background: #f5f5f5 !important; }
            .step-terminal-bar { display: none; }
            .step-terminal pre code { color: #333 !important; }
            .step-link-btn { background: none !important; color: black !important; border: 1px solid #999; box-shadow: none; }
            .step-num-list > li::before { background: #333 !important; }
        }

        @media print {
            body {
                background: white;
                color: black;
                padding: 0;
            }

            .top-bar, .back-to-top, .toc-fab, .sidebar, .sidebar-overlay, .file-upload, .loading, .error, .doc-nav, .code-copy-btn, .code-lang-label, .wizard-bar, .wizard-toggle {
                display: none !important;
            }

            .layout-wrapper {
                display: block;
            }

            .container {
                border: none;
                box-shadow: none;
                margin: 0;
                padding: 0;
                width: 100%;
                max-width: 100%;
            }

            #markdown-content {
                font-size: 10pt !important;
                line-height: 1.3;
            }

            h1, h2, h3 {
                page-break-after: avoid;
                page-break-inside: avoid;
                color: black !important;
            }

            h1 { font-size: 16pt; border-bottom: 2px solid #000; margin-top: 0.5em; margin-bottom: 0.5em; }
            h2 { font-size: 14pt; border-bottom: 1px solid #ccc; margin-top: 1em; margin-bottom: 0.5em; }
            h3 { font-size: 12pt; margin-top: 0.8em; margin-bottom: 0.4em; }

            p, ul, ol { margin-bottom: 0.8em; }

            pre, code {
                white-space: pre-wrap !important;
                word-wrap: break-word;
                border: 1px solid #ddd;
                background-color: #f5f5f5 !important;
                font-size: 9pt;
            }

            a { text-decoration: none; color: black !important; }

            table {
                width: 100%;
                border-collapse: collapse;
                page-break-inside: auto;
                margin-bottom: 1em;
            }

            tr { page-break-inside: avoid; }
            td, th { vertical-align: top; padding: 4px; border: 1px solid #ddd; }

            .two-column {
                column-count: 2;
                column-gap: 24px;
            }

            .two-column p {
                break-inside: avoid;
                margin-bottom: 8px;
                font-size: 9pt;
            }

            details, summary { display: block; }

            .collapsible-header::before { display: none !important; }
            .collapsible-header { padding-left: 0 !important; }
            .section-content.collapsed { display: block !important; }

            /* Print: show all wizard steps */
            [data-wizard-hidden] { display: block !important; }
            [style*="display: none"] { display: block !important; }
        }
    </style>
</head>
<body>
    <a href="#markdown-content" class="skip-link">Skip to content</a>

    <div class="top-bar">
        <button class="sidebar-reopen" id="sidebar-reopen" onclick="toggleSidebar()" aria-label="Show sidebar" title="Show sidebar">☰</button>
        <div class="logo">Vibe Coding Workshop</div>
        <div class="top-bar-row2">
            <div class="top-bar-doc" style="display:flex; align-items:center; gap:8px;">
                <button class="wizard-toggle" id="wizard-toggle" onclick="toggleWizardMode()" aria-label="Toggle step-by-step mode"><span>Step-by-Step</span></button>
                <select id="file-selector" aria-label="Select document" onchange="handleFileSelect(this.value)">
                    <!-- Populated by JS -->
                </select>
            </div>
            <div class="top-bar-doc top-bar-buttons">
                <button class="top-bar-btn" id="font-size-toggle" onclick="cycleFontSize()" aria-label="Change font size" title="Font size">A</button>
                <button class="top-bar-btn" id="toggle-sections" onclick="toggleAllSections()" aria-label="Expand or collapse all sections">
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 5l4 4 4-4"/>
                        <path d="M4 9l4 4 4-4"/>
                    </svg>
                </button>
                <button class="top-bar-btn" onclick="window.print()" aria-label="Print or save as PDF">
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="4" y="9" width="8" height="5" rx="0.5"/>
                        <path d="M4 11H2.5a1 1 0 0 1-1-1V6.5a1 1 0 0 1 1-1h11a1 1 0 0 1 1 1V10a1 1 0 0 1-1 1H12"/>
                        <path d="M4 5.5V2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v3"/>
                    </svg>
                </button>
            </div>
        </div>
        <div class="top-bar-global">
            <a class="top-bar-btn" href="https://github.com/eisenbruch/vibe-coding-workshops" target="_blank" rel="noopener noreferrer" aria-label="View GitHub repository">
                <svg viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
            </a>
            <button class="top-bar-btn" id="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode"></button>
        </div>
    </div>

    <div class="wizard-bar" id="wizard-bar" role="navigation" aria-label="Step navigation">
        <button class="wizard-nav-btn" id="wizard-prev" aria-label="Previous step" onclick="showWizardStep(wizardCurrentStep - 1)">← Back</button>
        <span class="wizard-step-counter" id="wizard-step-counter" aria-live="polite"></span>
        <div class="wizard-progress" id="wizard-progress" role="progressbar" aria-label="Step progress"></div>
        <button class="wizard-nav-btn primary" id="wizard-next" aria-label="Next step" onclick="showWizardStep(wizardCurrentStep + 1)">Next →</button>
    </div>

    <div class="layout-wrapper">
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <div class="sidebar-title"><span>Documents</span><button class="sidebar-collapse-btn" onclick="toggleSidebar()" aria-label="Hide sidebar" title="Hide sidebar">✕</button></div>
                <ul id="sidebar-docs" class="sidebar-docs-nav"></ul>
            </nav>
        </aside>

        <div class="container">
            <div class="loading">Loading...</div>
            <div id="markdown-content"></div>
            <div id="doc-nav" class="doc-nav" style="display: none;"></div>
        </div>
    </div>

    <button class="toc-fab" id="toc-fab" aria-label="Documents">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="12" y2="18"/>
        </svg>
    </button>
    <button class="back-to-top" id="back-to-top" aria-label="Back to top">↑</button>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <script>
        // ── Theme toggle ──────────────────────────────────────────────
        function getPreferredTheme() {
            const stored = localStorage.getItem('theme');
            if (stored) return stored;
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        const sunIcon = '<svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="8" r="3"/><path d="M8 1.5v1M8 13.5v1M1.5 8h1M13.5 8h1M3.4 3.4l.7.7M11.9 11.9l.7.7M3.4 12.6l.7-.7M11.9 4.1l.7-.7"/></svg>';
        const moonIcon = '<svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 8.9A5.5 5.5 0 0 1 7.1 2.5a5.5 5.5 0 1 0 6.4 6.4Z"/></svg>';

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const btn = document.getElementById('theme-toggle');
            btn.innerHTML = theme === 'dark' ? sunIcon : moonIcon;
            const metaTheme = document.querySelector('meta[name="theme-color"]');
            if (metaTheme) metaTheme.content = theme === 'dark' ? '#0d1117' : '#f6f8fa';
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme') || 'light';
            const next = current === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', next);
            applyTheme(next);
        }

        applyTheme(getPreferredTheme());

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
                applyTheme(e.matches ? 'dark' : 'light');
            }
        });

        // ── Font Size Control ─────────────────────────────────────────
        const FONT_SIZES = ['font-small', 'font-default', 'font-large', 'font-xlarge', 'font-xxlarge'];
        const FONT_LABELS = { 'font-small': 'S', 'font-default': 'M', 'font-large': 'L', 'font-xlarge': 'XL', 'font-xxlarge': 'XXL' };

        function getStoredFontSize() {
            return localStorage.getItem('fontSize') || 'font-default';
        }

        function applyFontSize(size) {
            FONT_SIZES.forEach(s => contentDiv.classList.remove(s));
            contentDiv.classList.add(size);
            const btn = document.getElementById('font-size-toggle');
            btn.innerHTML = 'A<span class="size-indicator">' + FONT_LABELS[size] + '</span>';
        }

        function cycleFontSize() {
            const current = getStoredFontSize();
            const idx = FONT_SIZES.indexOf(current);
            const next = FONT_SIZES[(idx + 1) % FONT_SIZES.length];
            localStorage.setItem('fontSize', next);
            applyFontSize(next);
        }

        // ── File Configuration ────────────────────────────────────────
        const FILE_GROUPS = [
            {
                label: "Start Here",
                files: [
                    { name: "Welcome", path: "welcome" },
                    { name: "What is Vibe Coding?", path: "what-is-vibe-coding" },
                    { name: "What You'll Learn", path: "what-youll-learn" },
                    { name: "Example Projects", path: "example-projects" },
                    { name: "Pick Your Path", path: "pick-your-path" },
                ]
            },
            {
                label: "Tool Setup (Pick Your Level)",
                files: [
                    { name: "Beginner Quick Start", path: "setup-beginner" },
                    { name: "Intermediate: Claude Desktop", path: "setup-claude-desktop" },
                    { name: "Intermediate: Google AI Studio", path: "setup-google-ai-studio" },
                    { name: "Advanced: Claude Code", path: "setup-claude-code" },
                    { name: "Advanced: Gemini CLI", path: "setup-gemini-cli" },
                ]
            },
            {
                label: "Build Together",
                files: [
                    { name: "Group Project", path: "group-project" },
                ]
            },
            {
                label: "Level Up",
                files: [
                    { name: "Vibe Coding Techniques", path: "Vibe Coding Techniques.md" },
                    { name: "Solo Project Guide", path: "Solo Project Guide.md" },
                ]
            },
            {
                label: "Deployment & Beyond",
                files: [
                    { name: "Firebase & Deployment", path: "Firebase & Deployment.md" },
                    { name: "Vercel & Supabase", path: "Vercel & Supabase.md" },
                    { name: "Custom Domains", path: "Custom Domains.md" },
                ]
            },
            {
                label: "Reference",
                files: [
                    { name: "Git for Beginners", path: "Git for Beginners.md" },
                    { name: "Claude Code Quick Reference", path: "Claude Code Quick Reference.md" },
                    { name: "Advanced Techniques", path: "Advanced Techniques.md" },
                    { name: "Project Idea Prompts", path: "Project Idea Prompts - Extended.md" },
                    { name: "AI Tools Directory", path: "AI Tools Directory.md" },
                    { name: "Backend & Hosting Platforms", path: "Backend & Hosting Platforms.md" },
                    { name: "Workshop Projects", path: "Workshop Projects.md" },
                ]
            },
            {
                label: "DomainFlip Build Docs",
                files: [
                    { name: "DomainFlip Summary", path: "docs/domainflip/domainflip_summary.md" },
                    { name: "Part 1 - Setup & Architecture", path: "docs/domainflip/BUILD_GUIDE_PART1.md" },
                    { name: "Part 2 - UI Components", path: "docs/domainflip/BUILD_GUIDE_PART2.md" },
                    { name: "Part 3 - Layout & Utilities", path: "docs/domainflip/BUILD_GUIDE_PART3.md" },
                    { name: "Part 4 - Mock Data: Domains", path: "docs/domainflip/BUILD_GUIDE_PART4.md" },
                    { name: "Part 5 - Mock Data: Users & More", path: "docs/domainflip/BUILD_GUIDE_PART5.md" },
                    { name: "Part 5B", path: "docs/domainflip/BUILD_GUIDE_PART5B.md" },
                    { name: "Part 5C", path: "docs/domainflip/BUILD_GUIDE_PART5C.md" },
                    { name: "Part 6 - Final Assembly", path: "docs/domainflip/BUILD_GUIDE_PART6.md" },
                ]
            }
        ];

        const PATH_OPTIONS = [
            {
                level: "Beginner",
                paths: [
                    {
                        name: "Quick Start",
                        icon: "\u{1F310}",
                        description: "Try vibe coding in your browser with zero setup. Great as a reference or quick demo.",
                        tools: "Browser only",
                        time: "~1 min",
                        cost: "free",
                        file: "setup-beginner"
                    }
                ]
            },
            {
                level: "Intermediate",
                paths: [
                    {
                        name: "Claude Desktop",
                        icon: "\u{1F4AC}",
                        description: "All-in-one AI assistant with Chat and Cowork modes. Visual interface, no IDE needed.",
                        tools: "Claude Desktop app",
                        time: "~5 min",
                        cost: "paid",
                        file: "setup-claude-desktop",
                        recommended: true
                    },
                    {
                        name: "Google AI Studio",
                        icon: "\u2728",
                        description: "Browser-based AI workspace powered by Gemini. No installs required.",
                        tools: "Browser only",
                        time: "~5 min",
                        cost: "free",
                        file: "setup-google-ai-studio"
                    }
                ]
            },
            {
                level: "Advanced",
                paths: [
                    {
                        name: "Claude Code",
                        icon: "\u{1F4BB}",
                        description: "AI coding agent in VS Code and the terminal. Full project control.",
                        tools: "VS Code + terminal",
                        time: "~15 min",
                        cost: "paid",
                        file: "setup-claude-code"
                    },
                    {
                        name: "Gemini CLI",
                        icon: "\u26A1",
                        description: "Free AI coding agent in VS Code and the terminal. Powered by Gemini.",
                        tools: "VS Code + terminal",
                        time: "~15 min",
                        cost: "free",
                        file: "setup-gemini-cli"
                    }
                ]
            }
        ];

        const AVAILABLE_FILES = FILE_GROUPS.flatMap(g => g.files);

        const selector = document.getElementById('file-selector');
        const contentDiv = document.getElementById('markdown-content');
        const loadingDiv = document.querySelector('.loading');

        FILE_GROUPS.forEach(group => {
            const optgroup = document.createElement('optgroup');
            optgroup.label = group.label;
            group.files.forEach(file => {
                const option = document.createElement('option');
                option.value = file.path;
                option.textContent = file.name;
                optgroup.appendChild(option);
            });
            selector.appendChild(optgroup);
        });

        let currentFile = AVAILABLE_FILES[0].path;
        const sectionStates = {};

        // Nav sequence: main workshop flow (Start Here → Build Together → Level Up → Deployment)
        const navGroups = ['Start Here', 'Build Together', 'Level Up', 'Deployment & Beyond'];
        const navSequence = FILE_GROUPS
            .filter(g => navGroups.includes(g.label))
            .flatMap(g => g.files.map(f => f.path));

        const docNavDiv = document.getElementById('doc-nav');

        function updateDocNav(filePath) {
            const idx = navSequence.indexOf(filePath);
            if (idx === -1) {
                docNavDiv.style.display = 'none';
                return;
            }
            docNavDiv.style.display = 'flex';
            const prev = idx > 0 ? AVAILABLE_FILES.find(f => f.path === navSequence[idx - 1]) : null;
            const next = idx < navSequence.length - 1 ? AVAILABLE_FILES.find(f => f.path === navSequence[idx + 1]) : null;

            let html = '';
            if (prev) {
                html += `<a href="#" class="nav-prev" data-path="${prev.path}">${prev.name}</a>`;
            }
            html += '<span class="nav-spacer"></span>';
            if (next) {
                html += `<a href="#" class="nav-next" data-path="${next.path}">${next.name}</a>`;
            }
            docNavDiv.innerHTML = html;

            docNavDiv.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const path = link.dataset.path;
                    selector.value = path;
                    loadMarkdown(path);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });
        }

        // ── Shared heading ID generator ───────────────────────────────
        function generateHeadingId(text) {
            return text.toString().toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .trim()
                .replace(/\s/g, '-');
        }

        // ── Pick Your Path ──────────────────────────────────────────
        function renderPickYourPath() {
            let html = '<div class="path-picker">';
            html += '<h1>Pick Your Path</h1>';
            html += '<p class="path-picker-subtitle">Choose your setup based on comfort level. Everyone builds the same project — just with different tools.</p>';

            PATH_OPTIONS.forEach(group => {
                html += '<div class="path-picker-level">';
                html += `<div class="path-picker-level-label">${group.level}</div>`;
                html += '<div class="path-picker-grid">';
                group.paths.forEach(p => {
                    const costClass = p.cost === 'free' ? 'free' : 'paid';
                    const costLabel = p.cost === 'free' ? 'Free' : 'Paid';
                    const badge = p.recommended ? '<span class="path-card-badge">Recommended</span>' : '';
                    html += `<div class="path-card" onclick="selectPath('${p.file}')" tabindex="0" role="button" aria-label="${p.name}">`;
                    html += badge;
                    html += `<div class="path-card-icon">${p.icon}</div>`;
                    html += `<div class="path-card-name">${p.name}</div>`;
                    html += `<div class="path-card-tools">${p.tools}</div>`;
                    html += `<div class="path-card-desc">${p.description}</div>`;
                    html += '<div class="path-card-pills">';
                    html += `<span class="path-pill time">${p.time}</span>`;
                    html += `<span class="path-pill ${costClass}">${costLabel}</span>`;
                    html += '</div>';
                    html += '</div>';
                });
                html += '</div></div>';
            });

            html += '<p class="path-picker-hint">Not sure? Start with Intermediate — you can always level up later.</p>';

            html += '<hr style="margin: 32px 0; border: none; border-top: 1px solid var(--border-color);">';
            html += '<h2 style="font-size:1.3em; font-weight:700; margin-bottom:12px;">Tool Comparison</h2>';
            html += '<p style="color:var(--text-muted); margin-bottom:16px;">A quick overview of the major AI models and when to reach for each:</p>';
            html += '<ul style="padding-left:1.5em; margin-bottom:16px;">';
            html += '<li><strong>Claude:</strong> The architect. Best for backend logic, complex architecture, and understanding large projects.</li>';
            html += '<li><strong>Gemini:</strong> The speed demon. Excellent for writing, rapid prototyping, and converting screenshots to UI code.</li>';
            html += '<li><strong>ChatGPT:</strong> The specialist. Useful for tackling specific tricky bugs other models struggle with.</li>';
            html += '</ul>';
            html += '<blockquote style="padding:0 1em; color:var(--text-muted); border-left:0.25em solid var(--blockquote-border);"><strong>Tip:</strong> Switch models when you get stuck!</blockquote>';

            html += '</div>';
            contentDiv.innerHTML = html;

            // Keyboard support for cards
            contentDiv.querySelectorAll('.path-card').forEach(card => {
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        card.click();
                    }
                });
            });
        }

        function selectPath(filePath) {
            selector.value = filePath;
            loadMarkdown(filePath);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ── Welcome Landing Page ─────────────────────────────────────
        const WELCOME_PROJECTS = [
            { name: "Glitch QR", icon: "📱", url: "https://github.com/eisenbruch/glitch-qr", type: "QR Code Tool", learning: "Simple tools in minutes" },
            { name: "Snark AI", icon: "📧", url: "https://snark-ai.com", type: "AI Email Service", learning: "Full services & websites" },
            { name: "Nerktendo", icon: "🎮", url: "https://nerktendo.com", type: "Retro Portfolio", learning: "Try different AI tools" },
            { name: "LinkPee", icon: "🔗", url: "https://linkp.ee", type: "Link-in-Bio Service", learning: "Complex features work" },
            { name: "Weather Worsener", icon: "🌧️", url: "https://nerktendo.com/weather-worsener", type: "Interactive Game", learning: "Fun iterative projects" },
            { name: "DomainFlip", icon: "💰", url: "https://nerktendo.com/domainflip", type: "Startup Demo", learning: "Vision + context = polish" },
            { name: "TrafficVision", icon: "🗺️", url: "https://trafficvision.live", type: "Map & Database", learning: "AI needs guidance at scale" },
        ];


        function renderWelcome() {
            let html = '<div class="welcome-landing">';

            // Hero
            html += '<div style="text-align:center; margin-bottom:40px;">';
            html += '<h1 style="font-size:2.4em; font-weight:800; border:none; margin-bottom:8px;">Welcome to the Vibe Coding Workshop</h1>';
            html += '<p style="color:var(--text-muted); font-size:1.1em; margin-bottom:4px;">Use AI to build real software — no coding experience required</p>';
            html += '<p style="color:var(--text-muted); font-size:0.9em;">By Noah Eisenbruch · <a href="mailto:noaheisenbruch@gmail.com">noaheisenbruch@gmail.com</a></p>';
            html += '</div>';

            // Follow Along
            html += '<div style="text-align:center; background:var(--bg-color); border:1.5px solid var(--border-color); border-radius:12px; padding:32px 24px; margin-bottom:40px;">';
            html += '<h2 style="font-size:1.1em; font-weight:700; text-transform:uppercase; letter-spacing:0.06em; color:var(--text-muted); margin-bottom:16px; border:none; padding:0;">Follow Along</h2>';
            html += '<p style="font-size:2em; font-weight:800; letter-spacing:-0.01em; margin-bottom:4px; color:var(--text-color);">workshop.nerktek.com</p>';
            html += '<p style="color:var(--text-muted); font-size:0.95em; margin-bottom:20px;">Type the URL above or scan the QR code to open this site on your device</p>';
            html += '<img src="images/github-site-qr.png" alt="Workshop QR Code" style="width:180px; height:180px; border-radius:10px;">';
            html += '</div>';

            // Explore the Workshop
            html += '<h2 style="font-size:1.1em; font-weight:700; text-transform:uppercase; letter-spacing:0.06em; color:var(--text-muted); text-align:center; margin-bottom:16px; border:none; padding:0;">Explore the Workshop</h2>';
            html += '<div class="path-picker-grid" style="margin-bottom:40px;">';
            html += '<div class="path-card" onclick="loadRoute(\'what-is-vibe-coding\')" tabindex="0" role="button">';
            html += '<div class="path-card-icon">🧠</div>';
            html += '<div class="path-card-name">What is Vibe Coding?</div>';
            html += '<div class="path-card-desc">Learn how AI-assisted coding works and what you\'ll build in this workshop</div>';
            html += '</div>';
            html += '<div class="path-card" onclick="loadRoute(\'example-projects\')" tabindex="0" role="button">';
            html += '<div class="path-card-icon">🚀</div>';
            html += '<div class="path-card-name">Example Projects</div>';
            html += '<div class="path-card-desc">See what\'s possible — real projects built with vibe coding</div>';
            html += '</div>';
            html += '<div class="path-card" onclick="loadRoute(\'pick-your-path\')" tabindex="0" role="button">';
            html += '<div class="path-card-icon">🛤️</div>';
            html += '<div class="path-card-name">Pick Your Path</div>';
            html += '<div class="path-card-desc">Choose your setup based on comfort level and start building</div>';
            html += '</div>';
            html += '</div>';

            // Feedback
            html += '<div style="text-align:center; border-top:1px solid var(--border-color); padding-top:28px;">';
            html += '<p style="color:var(--text-muted); font-size:0.95em; margin-bottom:12px;">Your feedback helps shape future workshops</p>';
            html += '<a href="https://forms.gle/3iVRWgUS6o8U51Ut5" target="_blank" rel="noopener noreferrer" class="step-link-btn" style="font-size:0.95em;">Leave Feedback</a>';
            html += '</div>';

            html += '</div>';
            contentDiv.innerHTML = html;
            addCardKeyboardSupport();
        }

        function renderWhatIsVibeCoding() {
            let html = '<div class="path-picker">';
            html += '<h1>What is Vibe Coding?</h1>';
            html += '<p class="path-picker-subtitle">Describe what you want. AI writes the code. You guide the result.</p>';
            html += '</div>';

            // How it works — three visual columns
            html += '<div class="path-picker-grid" style="margin-bottom:32px;">';
            html += '<div class="path-card" style="cursor:default; text-align:center;">';
            html += '<div class="path-card-icon">💬</div>';
            html += '<div class="path-card-name">You Describe</div>';
            html += '<div class="path-card-desc">Tell the AI what you want in plain language — no syntax or programming knowledge needed</div>';
            html += '</div>';
            html += '<div class="path-card" style="cursor:default; text-align:center;">';
            html += '<div class="path-card-icon">⚡</div>';
            html += '<div class="path-card-name">AI Builds</div>';
            html += '<div class="path-card-desc">The AI generates working code — websites, tools, games, full applications</div>';
            html += '</div>';
            html += '<div class="path-card" style="cursor:default; text-align:center;">';
            html += '<div class="path-card-icon">🔄</div>';
            html += '<div class="path-card-name">You Iterate</div>';
            html += '<div class="path-card-desc">Test it, tell the AI what to change, and refine until it\'s exactly what you want</div>';
            html += '</div>';
            html += '</div>';

            html += '<div class="step-callout note" style="margin-bottom:32px;">';
            html += '<span class="step-callout-icon">💡</span>';
            html += '<div class="step-callout-body">No coding experience required to start. As you build more complex projects, understanding your tools becomes important — and your AI can teach you along the way.</div>';
            html += '</div>';

            // CTA
            html += '<div style="text-align:center; padding:16px 0;">';
            html += '<a href="#what-youll-learn" class="step-link-btn" style="font-size:1.05em; padding:10px 28px;" onclick="event.preventDefault(); loadRoute(\'what-youll-learn\');">What You\'ll Learn →</a>';
            html += '</div>';

            contentDiv.innerHTML = html;
        }

        function renderWhatYoullLearn() {
            let html = '<div class="path-picker">';
            html += '<h1>What You\'ll Learn</h1>';
            html += '<p class="path-picker-subtitle">From idea to deployed project — the full vibe coding workflow</p>';
            html += '</div>';

            html += '<ol class="step-num-list" style="margin-bottom:32px;">';
            html += '<li><strong>Use any AI coding agent</strong> — Claude, Gemini, ChatGPT, and more. Pick the right tool for you.</li>';
            html += '<li><strong>Prompt effectively</strong> — Write clear descriptions that produce the code you actually want.</li>';
            html += '<li><strong>Iterate and debug</strong> — Test, refine, and fix issues by communicating with your AI.</li>';
            html += '<li><strong>Set up real projects</strong> — File structure, dependencies, and configuration from scratch.</li>';
            html += '<li><strong>Use Git and GitHub</strong> — Save checkpoints, create branches, push your code, and roll back if something breaks.</li>';
            html += '<li><strong>Deploy to the web</strong> — Ship your project so anyone can use it.</li>';
            html += '</ol>';

            html += '<div class="step-callout tip" style="margin-bottom:32px;">';
            html += '<span class="step-callout-icon">🎯</span>';
            html += '<div class="step-callout-body">The core workflow is <strong>prompt → test → iterate → commit</strong>. You\'ll practice this cycle throughout the workshop.</div>';
            html += '</div>';

            // CTA
            html += '<div style="text-align:center; padding:16px 0;">';
            html += '<a href="#example-projects" class="step-link-btn" style="font-size:1.05em; padding:10px 28px;" onclick="event.preventDefault(); loadRoute(\'example-projects\');">See Example Projects →</a>';
            html += '</div>';

            contentDiv.innerHTML = html;
        }

        function renderExampleProjects() {
            let html = '<div class="path-picker">';
            html += '<h1>Example Projects</h1>';
            html += '<p class="path-picker-subtitle">Real projects built with vibe coding — from quick tools to full applications</p>';
            html += '</div>';

            html += '<div class="path-picker-grid" style="margin-bottom:24px;">';
            WELCOME_PROJECTS.forEach(p => {
                html += `<a href="${p.url}" target="_blank" rel="noopener noreferrer" class="path-card" style="text-decoration:none; cursor:pointer;">`;
                html += `<div class="path-card-icon">${p.icon}</div>`;
                html += `<div class="path-card-name">${p.name}</div>`;
                html += `<div class="path-card-tools">${p.type}</div>`;
                html += `<div class="path-card-desc">${p.learning}</div>`;
                html += '</a>';
            });
            html += '</div>';

            html += '<h2 style="font-size:1.3em; font-weight:700; margin-bottom:12px; border-bottom:1px solid var(--header-border); padding-bottom:0.3em;">Other Projects</h2>';
            html += '<ul style="padding-left:1.5em; margin-bottom:24px; line-height:1.7;">';
            html += '<li><strong>Raspberry Pi Instant Camera</strong> — prints instant picture stickers with text and current date/time</li>';
            html += '<li><strong>Blender Addon</strong> — optimally rotates a 3D object to minimize its bounding box for manufacturing</li>';
            html += '</ul>';

            html += '<div class="step-callout note" style="margin-bottom:24px;">';
            html += '<span class="step-callout-icon">💡</span>';
            html += '<div class="step-callout-body"><strong>Key Takeaway:</strong> Don\'t limit yourself. If you think it should exist, just try to create it. Vibe coding can make testing concepts easier than creating a mockup.</div>';
            html += '</div>';

            html += '<div class="step-callout tip" style="margin-bottom:32px;">';
            html += '<span class="step-callout-icon">🔧</span>';
            html += '<div class="step-callout-body"><strong>Remember:</strong> AI can help with more than just code — it can help prototype your hardware, organize your files, and much more.</div>';
            html += '</div>';

            // CTA
            html += '<div style="text-align:center; padding:24px 0;">';
            html += '<a href="#pick-your-path" class="step-link-btn" style="font-size:1.05em; padding:10px 28px;" onclick="event.preventDefault(); loadRoute(\'pick-your-path\');">Choose Your Setup Path →</a>';
            html += '</div>';

            contentDiv.innerHTML = html;
            addCardKeyboardSupport();
        }

        function loadRoute(route) {
            selector.value = route;
            loadMarkdown(route);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function addCardKeyboardSupport() {
            contentDiv.querySelectorAll('.path-card').forEach(card => {
                if (!card.getAttribute('tabindex')) card.setAttribute('tabindex', '0');
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        card.click();
                    }
                });
            });
        }

        // ── Beginner Quick Start ─────────────────────────────────────
        function renderBeginnerQuickStart(step) {
            step = step || 0;
            var html = '';

            // Header — always visible
            html += '<div class="path-picker">';
            html += '<h1>Beginner Quick Start</h1>';

            if (step === 0) {
                // ── Pick a Tool ──
                html += '<p class="path-picker-subtitle">Open any of these in your browser — they all work the same way.</p>';
                html += '</div>';

                html += '<div class="path-picker-grid" style="margin-bottom:32px;">';
                var tools = [
                    { name: 'Claude.ai', icon: '💬', url: 'https://claude.ai', desc: 'Generates an interactive <strong>artifact</strong> — see and use it right in the chat' },
                    { name: 'ChatGPT', icon: '🤖', url: 'https://chatgpt.com', desc: 'Generates a <strong>canvas</strong> — live preview right in the conversation' },
                    { name: 'Gemini', icon: '✨', url: 'https://gemini.google.com', desc: 'Generates code with a <strong>preview</strong> panel alongside the chat' },
                    { name: 'Google AI Studio', icon: '🧪', url: 'https://aistudio.google.com', desc: 'Prototype with Gemini models — code output with preview' },
                ];
                tools.forEach(function(t) {
                    html += '<a href="' + t.url + '" target="_blank" rel="noopener noreferrer" class="path-card" style="text-decoration:none; cursor:pointer;">';
                    html += '<div class="path-card-icon">' + t.icon + '</div>';
                    html += '<div class="path-card-name">' + t.name + '</div>';
                    html += '<div class="path-card-desc">' + t.desc + '</div>';
                    html += '</a>';
                });
                html += '</div>';

                html += '<div style="display:flex; justify-content:center; align-items:center; gap:12px; padding:16px 0;">';
                html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px;" onclick="event.preventDefault(); renderBeginnerQuickStart(1); window.scrollTo({top:0,behavior:\'smooth\'});">Try It Now →</a>';
                html += '</div>';

            } else if (step === 1) {
                // ── Try It Now ──
                html += '<p class="path-picker-subtitle">Paste this into your chosen tool and watch it build.</p>';
                html += '</div>';

                html += _term('Create a personal countdown timer to New Year\'s Eve. Make it visually appealing with a dark theme and animated numbers.');

                html += '<div class="path-picker-grid" style="margin-top:24px; margin-bottom:32px;">';
                html += '<div class="path-card" style="cursor:default; text-align:center;">';
                html += '<div class="path-card-icon">💬</div>';
                html += '<div class="path-card-name">Describe</div>';
                html += '<div class="path-card-desc">Tell the AI what you want in plain language</div>';
                html += '</div>';
                html += '<div class="path-card" style="cursor:default; text-align:center;">';
                html += '<div class="path-card-icon">👀</div>';
                html += '<div class="path-card-name">See It Appear</div>';
                html += '<div class="path-card-desc">The AI builds it and shows you the result — no files needed</div>';
                html += '</div>';
                html += '<div class="path-card" style="cursor:default; text-align:center;">';
                html += '<div class="path-card-icon">🔄</div>';
                html += '<div class="path-card-name">Iterate</div>';
                html += '<div class="path-card-desc">"Make it neon green" or "Add confetti when it hits zero"</div>';
                html += '</div>';
                html += '</div>';

                html += '<div style="display:flex; justify-content:center; align-items:center; gap:12px; padding:16px 0;">';
                html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px; background:var(--surface-color); color:var(--text-muted); border:1px solid var(--border-color);" onclick="event.preventDefault(); renderBeginnerQuickStart(0); window.scrollTo({top:0,behavior:\'smooth\'});">← Back</a>';
                html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px;" onclick="event.preventDefault(); renderBeginnerQuickStart(2); window.scrollTo({top:0,behavior:\'smooth\'});">What You Can Build →</a>';
                html += '</div>';

            } else if (step === 2) {
                // ── What You Can Build ──
                html += '<p class="path-picker-subtitle">Browser AI is great for quick single-page creations.</p>';
                html += '</div>';

                html += '<div class="path-picker-grid" style="margin-bottom:24px;">';
                var examples = [
                    { icon: '🧮', name: 'Calculators & Tools', desc: 'Timers, converters, trackers' },
                    { icon: '🧠', name: 'Quizzes & Games', desc: 'Trivia, puzzles, simple games' },
                    { icon: '🎨', name: 'Visual Demos', desc: 'Animations, art, simulations' },
                    { icon: '📄', name: 'Landing Pages', desc: 'Portfolios, resumes, promo pages' },
                ];
                examples.forEach(function(b) {
                    html += '<div class="path-card" style="cursor:default; text-align:center;">';
                    html += '<div class="path-card-icon">' + b.icon + '</div>';
                    html += '<div class="path-card-name">' + b.name + '</div>';
                    html += '<div class="path-card-desc">' + b.desc + '</div>';
                    html += '</div>';
                });
                html += '</div>';

                html += '<div class="step-callout note" style="margin-bottom:32px;">';
                html += '<span class="step-callout-icon">📝</span>';
                html += '<div class="step-callout-body">These creations live in the chat session — they\'re not saved as files on your computer. For real projects with version control and deployment, check out the Intermediate or Advanced setup paths.</div>';
                html += '</div>';

                html += '<div style="display:flex; justify-content:center; align-items:center; gap:12px; padding:16px 0;">';
                html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px; background:var(--surface-color); color:var(--text-muted); border:1px solid var(--border-color);" onclick="event.preventDefault(); renderBeginnerQuickStart(1); window.scrollTo({top:0,behavior:\'smooth\'});">← Back</a>';
                html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px;" onclick="event.preventDefault(); renderBeginnerQuickStart(3); window.scrollTo({top:0,behavior:\'smooth\'});">What\'s Next? →</a>';
                html += '</div>';

            } else {
                // ── What's Next? ──
                html += "<p class=\"path-picker-subtitle\">Your setup is complete. Where would you like to go?</p>";
                html += '</div>';

                html += '<div style="display:flex; justify-content:center; padding:0 0 24px;">';
                html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px; background:var(--surface-color); color:var(--text-muted); border:1px solid var(--border-color);" onclick="event.preventDefault(); renderBeginnerQuickStart(2); window.scrollTo({top:0,behavior:\'smooth\'});">← Back</a>';
                html += '</div>';

                html += '<div class="path-picker-grid">';
                html += '<div class="path-card" onclick="loadRoute(\'pick-your-path\')" tabindex="0" role="button">';
                html += '<div class="path-card-icon">🛤️</div>';
                html += '<div class="path-card-name">Back to Pick Your Path</div>';
                html += '<div class="path-card-desc">Explore other setup options</div>';
                html += '</div>';
                html += '<div class="path-card" onclick="loadRoute(\'group-project\')" tabindex="0" role="button">';
                html += '<div class="path-card-icon">🚀</div>';
                html += '<div class="path-card-name">Start the Group Project</div>';
                html += '<div class="path-card-desc">Jump into the hands-on group build</div>';
                html += '</div>';
                html += '</div>';
            }

            contentDiv.innerHTML = html;
            addCardKeyboardSupport();
            addCopyButtons();
        }

        // ── Setup Guide Data & Renderer ──────────────────────────────
        function _tip(t) { return '<div class="step-callout tip"><span class="step-callout-icon">💡</span><div class="step-callout-body">' + t + '</div></div>'; }
        function _note(t) { return '<div class="step-callout note"><span class="step-callout-icon">📝</span><div class="step-callout-body">' + t + '</div></div>'; }
        function _warn(t) { return '<div class="step-callout warning"><span class="step-callout-icon">⚠️</span><div class="step-callout-body">' + t + '</div></div>'; }
        function _term(code) { return '<div class="step-terminal"><pre><code>' + code + '</code></pre></div>'; }
        function _check(items) { return '<ul class="step-checklist">' + items.map(function(t) { return '<li><span class="step-checklist-icon">✅</span><span>' + t + '</span></li>'; }).join('') + '</ul>'; }

        const SETUP_GUIDES = {
            'setup-claude-desktop': {
                name: 'Intermediate Setup — Claude Desktop',
                subtitle: 'All-in-one AI assistant with Chat and Cowork modes. Visual interface, no IDE needed.',
                steps: [
                    {
                        title: 'Create Your Account',
                        content: '<h2>Step 1: Create Your Account</h2>'
                            + _note('If you don\'t want a paid plan, use <a href="#" onclick="event.preventDefault(); loadRoute(\'setup-google-ai-studio\');">Google AI Studio</a> instead — it\'s free and follows a similar workflow.')
                            + '<ol class="step-num-list">'
                            + '<li>Go to <a href="https://claude.ai/pricing" target="_blank" rel="noopener noreferrer" class="step-link-btn">claude.ai/pricing</a></li>'
                            + '<li>Sign up for a <strong>Pro</strong> plan (recommended for the workshop)</li>'
                            + '</ol>'
                            + _tip('Already have a Claude account? Just make sure you\'re on a paid plan — Pro gives you access to Cowork mode.')
                    },
                    {
                        title: 'Download Claude Desktop',
                        content: '<h2>Step 2: Download Claude Desktop</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Go to <a href="https://claude.ai/download" target="_blank" rel="noopener noreferrer" class="step-link-btn">claude.ai/download</a></li>'
                            + '<li>Download for your operating system (Mac or Windows)</li>'
                            + '<li>Run the installer</li>'
                            + '<li>Launch Claude Desktop and sign in</li>'
                            + '</ol>'
                            + _tip('Claude Desktop is a separate app from the browser version. You need to download it even if you already use claude.ai.')
                    },
                    {
                        title: 'Explore the Interface',
                        content: '<h2>Step 3: Explore the Interface</h2>'
                            + '<p>Claude Desktop has three modes — switch between them using the toggle at the top:</p>'
                            + '<div class="path-picker-grid" style="margin:20px 0;">'
                            + '<div class="path-card" style="cursor:default; text-align:center;"><div class="path-card-icon">💬</div><div class="path-card-name">Chat</div><div class="path-card-desc">Conversation — ask questions, brainstorm, get explanations</div></div>'
                            + '<div class="path-card" style="cursor:default; text-align:center; border-color:var(--accent-color);"><div class="path-card-icon">🤝</div><div class="path-card-name">Cowork</div><div class="path-card-desc">Agentic — Claude reads and writes files on your computer</div></div>'
                            + '<div class="path-card" style="cursor:default; text-align:center;"><div class="path-card-icon">💻</div><div class="path-card-name">Code</div><div class="path-card-desc">Full coding agent running on cloud VMs</div></div>'
                            + '</div>'
                            + _tip('For the workshop, we\'ll use <strong>Cowork mode</strong>. You describe what you want, Claude builds it — writing real files you can open and run.')
                    },
                    {
                        title: 'Set Up Your Project Folder',
                        content: '<h2>Step 4: Set Up Your Project Folder</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Create a folder called <code>workshop-project</code> on your Desktop</li>'
                            + '<li>In Claude Desktop, switch to <strong>Cowork mode</strong></li>'
                            + '<li>Tell Claude about your folder:</li>'
                            + '</ol>'
                            + _term('I\'m working in a project folder at ~/Desktop/workshop-project. We\'ll be building a project together.')
                            + '<p style="margin-top:12px;">Claude can now create and edit files in that folder.</p>'
                    },
                    {
                        title: 'Install Developer Tools',
                        content: '<h2>Step 5: Install Developer Tools</h2>'
                            + '<p>Paste this prompt into Claude Desktop. It will check and install everything automatically:</p>'
                            + _term('Check my system and install any of these developer tools that are missing:\n- Homebrew (Mac only — package manager)\n- Node.js and npm (JavaScript runtime)\n- Git (version control)\n- gh (GitHub CLI)\n- firebase-tools (Firebase deployment — install globally with npm)\n\nFor each tool: check if it\'s already installed first, skip it if so.\nFor anything you can\'t install directly, give me the exact steps to do it myself.\nDon\'t sign in to or configure anything yet — just install.')
                            + _note('Claude will ask permission to run commands — say yes. This may take a few minutes.')
                            + _warn('Having trouble? Don\'t worry — skip this step. You can install tools later, and the group project works without them.')
                    },
                    {
                        title: "You're Ready!",
                        content: '<h2>Step 6: You\'re Ready!</h2>'
                            + '<p>Your setup is complete:</p>'
                            + _check(['Claude Pro account', 'Claude Desktop installed', 'Project folder ready', 'Developer tools installed (or ready to install later)'])
                    }
                ]
            },
            'setup-google-ai-studio': {
                name: 'Intermediate Setup — Google AI Studio',
                subtitle: 'Browser-based AI workspace powered by Gemini. No installs required.',
                steps: [
                    {
                        title: 'Create Your Account',
                        content: '<h2>Step 1: Create Your Account</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Go to <a href="https://aistudio.google.com" target="_blank" rel="noopener noreferrer" class="step-link-btn">aistudio.google.com</a></li>'
                            + '<li>Sign in with your Google account</li>'
                            + '</ol>'
                            + _tip('Google AI Studio is completely free. No Google account? Create one at <a href="https://accounts.google.com" target="_blank" rel="noopener noreferrer">accounts.google.com</a>.')
                    },
                    {
                        title: 'Start a New Chat',
                        content: '<h2>Step 2: Start a New Chat</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Click <strong>"New Chat"</strong> or <strong>"Create New"</strong></li>'
                            + '<li>Select the latest Gemini model available (e.g., Gemini 2.5 Pro)</li>'
                            + '</ol>'
                            + _tip('Always use the most capable model available — newer models write better code.')
                    },
                    {
                        title: 'How It Works',
                        content: '<h2>Step 3: How It Works</h2>'
                            + '<p>Google AI Studio gives you a chat interface where you:</p>'
                            + '<ol class="step-num-list">'
                            + '<li><strong>Describe</strong> what you want to build — Gemini generates the code</li>'
                            + '<li><strong>Copy</strong> the generated code into a file</li>'
                            + '<li><strong>Open</strong> the file in your browser to see it</li>'
                            + '<li><strong>Iterate</strong> — ask for changes in follow-up messages</li>'
                            + '</ol>'
                            + _note('You can also upload images (screenshots, mockups) and files (existing code) to give Gemini more context.')
                    },
                    {
                        title: 'Set Up Your Project Folder',
                        content: '<h2>Step 4: Set Up Your Project Folder</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Create a folder called <code>workshop-project</code> on your Desktop</li>'
                            + '<li>When Gemini generates code, copy it from the chat</li>'
                            + '<li>Paste into a text editor (TextEdit, Notepad, or VS Code)</li>'
                            + '<li>Save with the filename Gemini suggests (e.g., <code>index.html</code>) into your folder</li>'
                            + '</ol>'
                    },
                    {
                        title: 'Install Developer Tools (Optional)',
                        content: '<h2>Step 5: Install Developer Tools (Optional)</h2>'
                            + '<p>Since AI Studio runs in the browser, it can\'t install tools for you. These are optional — you\'ll need them later for Git and deployment.</p>'
                            + '<h3>Mac</h3>'
                            + '<p>Open Terminal and run:</p>'
                            + _term('/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"\nbrew install node git gh\nnpm install -g firebase-tools', 'bash')
                            + '<h3>Windows</h3>'
                            + '<p>Download and install:</p>'
                            + '<ol class="step-num-list">'
                            + '<li><a href="https://nodejs.org" target="_blank" rel="noopener noreferrer" class="step-link-btn">Node.js</a> (LTS version)</li>'
                            + '<li><a href="https://git-scm.com" target="_blank" rel="noopener noreferrer" class="step-link-btn">Git</a></li>'
                            + '<li><a href="https://cli.github.com" target="_blank" rel="noopener noreferrer" class="step-link-btn">GitHub CLI</a></li>'
                            + '<li>Then run: <code>npm install -g firebase-tools</code></li>'
                            + '</ol>'
                            + _warn('Not comfortable with the terminal? Skip this step entirely. The group project works without these tools — you can always install them later.')
                    },
                    {
                        title: "You're Ready!",
                        content: '<h2>Step 6: You\'re Ready!</h2>'
                            + '<p>Your setup is complete:</p>'
                            + _check(['Google account with AI Studio access', 'Gemini ready to generate code', 'Project folder ready'])
                            + _tip('Gemini is fast and great at generating visual code. Don\'t hesitate to ask for big changes — regenerating is quick.')
                    }
                ]
            },
            'setup-claude-code': {
                name: 'Advanced Setup — Claude Code',
                subtitle: 'AI coding agent in VS Code and the terminal. Full project control.',
                steps: [
                    {
                        title: 'Install VS Code',
                        content: '<h2>Step 1: Install VS Code</h2>'
                            + _note('If you don\'t want a paid plan, use <a href="#" onclick="event.preventDefault(); loadRoute(\'setup-gemini-cli\');">Gemini CLI</a> instead — it\'s free and follows a similar workflow.')
                            + '<ol class="step-num-list">'
                            + '<li>Download <a href="https://code.visualstudio.com/download" target="_blank" rel="noopener noreferrer" class="step-link-btn">VS Code</a> for your operating system</li>'
                            + '<li>Run the installer</li>'
                            + '<li>Launch VS Code</li>'
                            + '</ol>'
                            + _tip('Already use Cursor or Antigravity? Those work too — the steps are nearly identical.')
                    },
                    {
                        title: 'Sign Up for Claude',
                        content: '<h2>Step 2: Sign Up for Claude</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Go to <a href="https://claude.ai/pricing" target="_blank" rel="noopener noreferrer" class="step-link-btn">claude.ai/pricing</a></li>'
                            + '<li>Sign up for <strong>Pro</strong> or <strong>Max</strong></li>'
                            + '</ol>'
                            + _note('Claude Code requires a paid subscription.')
                    },
                    {
                        title: 'Install Claude Code',
                        content: '<h2>Step 3: Install Claude Code</h2>'
                            + '<p>Pick whichever feels more comfortable — both connect to the same AI:</p>'
                            + '<h3>Option A: VS Code Extension (recommended to start)</h3>'
                            + '<ol class="step-num-list">'
                            + '<li>Install the <a href="https://marketplace.visualstudio.com/items?itemName=anthropic.claude-code" target="_blank" rel="noopener noreferrer" class="step-link-btn">Claude Code extension</a> from the marketplace</li>'
                            + '<li>Click the Claude icon in the editor toolbar</li>'
                            + '<li>Sign in when prompted</li>'
                            + '</ol>'
                            + '<h3>Option B: CLI Tool (for terminal users)</h3>'
                            + '<ol class="step-num-list">'
                            + '<li>Follow the <a href="https://code.claude.com/docs/en/setup#native-install-recommended" target="_blank" rel="noopener noreferrer" class="step-link-btn">CLI installation guide</a></li>'
                            + '<li>Open a terminal in VS Code (<code>Ctrl+`</code>)</li>'
                            + '<li>Type <code>claude</code> to start</li>'
                            + '</ol>'
                    },
                    {
                        title: 'Create Your Project Folder',
                        content: '<h2>Step 4: Create Your Project Folder</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Create a folder called <code>workshop-project</code> on your Desktop</li>'
                            + '<li>In VS Code: <strong>File → Open Folder</strong> → select it</li>'
                            + '<li>Open Claude Code (extension panel or terminal)</li>'
                            + '</ol>'
                            + '<p style="margin-top:12px;">You should see your empty folder in VS Code\'s file explorer and Claude Code ready to go.</p>'
                    },
                    {
                        title: 'Quick Terminal Intro',
                        content: '<h2>Step 5: Quick Terminal Intro</h2>'
                            + '<p>Open the terminal in VS Code with <code>Ctrl+`</code> or <strong>View → Terminal</strong>.</p>'
                            + '<p style="margin-top:12px;">The key thing to know: <strong>you don\'t need to memorize commands.</strong> Your AI runs commands for you. Just describe what you need.</p>'
                            + _tip('Try saying: "Start a local server so I can preview my project" — Claude will handle the rest.')
                    },
                    {
                        title: 'Install Developer Tools',
                        content: '<h2>Step 6: Install Developer Tools</h2>'
                            + '<p>Paste this prompt into Claude Code:</p>'
                            + _term('Check my system and install any of these developer tools that are missing:\n- Homebrew (Mac only — package manager)\n- Node.js and npm (JavaScript runtime)\n- Git (version control)\n- gh (GitHub CLI)\n- firebase-tools (Firebase deployment — install globally with npm)\n\nFor each tool: check if it\'s already installed first, skip it if so.\nFor anything you can\'t install directly, give me the exact steps to do it myself.\nDon\'t sign in to or configure anything yet — just install.')
                            + _note('Claude will ask permission to run commands — say yes. This may take a few minutes.')
                    },
                    {
                        title: "You're Ready!",
                        content: '<h2>Step 7: You\'re Ready!</h2>'
                            + '<p>Your setup is complete:</p>'
                            + _check(['VS Code installed', 'Claude Code connected', 'Project folder ready', 'Developer tools installed'])
                            + '<h3 style="margin-top:24px;">Quick Reference</h3>'
                            + '<div class="path-picker-grid" style="margin-top:12px;">'
                            + '<div class="path-card" style="cursor:default; text-align:center;"><div class="path-card-name" style="font-family:monospace;">claude</div><div class="path-card-desc">Start Claude in your terminal</div></div>'
                            + '<div class="path-card" style="cursor:default; text-align:center;"><div class="path-card-name" style="font-family:monospace;">shift + tab</div><div class="path-card-desc">Change modes (planning, accept edits, permissions)</div></div>'
                            + '<div class="path-card" style="cursor:default; text-align:center;"><div class="path-card-name" style="font-family:monospace;">@</div><div class="path-card-desc">Mention a file in your project</div></div>'
                            + '<div class="path-card" style="cursor:default; text-align:center;"><div class="path-card-name" style="font-family:monospace;">esc</div><div class="path-card-desc">Interrupt Claude while it\'s working</div></div>'
                            + '</div>'
                    }
                ]
            },
            'setup-gemini-cli': {
                name: 'Advanced Setup — Gemini CLI',
                subtitle: 'Free AI coding agent in VS Code and the terminal. Powered by Gemini.',
                steps: [
                    {
                        title: 'Install VS Code',
                        content: '<h2>Step 1: Install VS Code</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Download <a href="https://code.visualstudio.com/download" target="_blank" rel="noopener noreferrer" class="step-link-btn">VS Code</a> for your operating system</li>'
                            + '<li>Run the installer</li>'
                            + '<li>Launch VS Code</li>'
                            + '</ol>'
                            + _tip('Already use Cursor or Antigravity? Those work too — the steps are nearly identical.')
                    },
                    {
                        title: 'Sign Up for Google',
                        content: '<h2>Step 2: Sign Up for Google</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Go to <a href="https://gemini.google.com" target="_blank" rel="noopener noreferrer" class="step-link-btn">gemini.google.com</a></li>'
                            + '<li>Sign in with your Google account</li>'
                            + '</ol>'
                            + _tip('Gemini CLI is completely free. No Google account? Create one at <a href="https://accounts.google.com" target="_blank" rel="noopener noreferrer">accounts.google.com</a>.')
                    },
                    {
                        title: 'Install Gemini Code Assist',
                        content: '<h2>Step 3: Install Gemini Code Assist</h2>'
                            + '<p>Pick whichever feels more comfortable — both connect to the same AI:</p>'
                            + '<h3>Option A: VS Code Extension (recommended to start)</h3>'
                            + '<ol class="step-num-list">'
                            + '<li>Install the <a href="https://marketplace.visualstudio.com/items?itemName=Google.geminicodeassist" target="_blank" rel="noopener noreferrer" class="step-link-btn">Gemini Code Assist extension</a> from the marketplace</li>'
                            + '<li>Click the Gemini icon in the sidebar</li>'
                            + '<li>Sign in when prompted</li>'
                            + '</ol>'
                            + '<h3>Option B: CLI Tool (for terminal users)</h3>'
                            + '<ol class="step-num-list">'
                            + '<li>Follow the installation guide at <a href="https://codeassist.google" target="_blank" rel="noopener noreferrer" class="step-link-btn">codeassist.google</a></li>'
                            + '<li>Open a terminal in VS Code (<code>Ctrl+`</code>)</li>'
                            + '<li>Type <code>gemini</code> to start</li>'
                            + '</ol>'
                    },
                    {
                        title: 'Create Your Project Folder',
                        content: '<h2>Step 4: Create Your Project Folder</h2>'
                            + '<ol class="step-num-list">'
                            + '<li>Create a folder called <code>workshop-project</code> on your Desktop</li>'
                            + '<li>In VS Code: <strong>File → Open Folder</strong> → select it</li>'
                            + '<li>Open Gemini (extension panel or terminal)</li>'
                            + '</ol>'
                            + '<p style="margin-top:12px;">You should see your empty folder in VS Code\'s file explorer and Gemini ready to go.</p>'
                    },
                    {
                        title: 'Quick Terminal Intro',
                        content: '<h2>Step 5: Quick Terminal Intro</h2>'
                            + '<p>Open the terminal in VS Code with <code>Ctrl+`</code> or <strong>View → Terminal</strong>.</p>'
                            + '<p style="margin-top:12px;">The key thing to know: <strong>you don\'t need to memorize commands.</strong> Your AI runs commands for you. Just describe what you need.</p>'
                            + _tip('Try saying: "Start a local server so I can preview my project" — Gemini will handle the rest.')
                    },
                    {
                        title: 'Install Developer Tools',
                        content: '<h2>Step 6: Install Developer Tools</h2>'
                            + '<p>Paste this prompt into Gemini:</p>'
                            + _term('Check my system and install any of these developer tools that are missing:\n- Homebrew (Mac only — package manager)\n- Node.js and npm (JavaScript runtime)\n- Git (version control)\n- gh (GitHub CLI)\n- firebase-tools (Firebase deployment — install globally with npm)\n\nFor each tool: check if it\'s already installed first, skip it if so.\nFor anything you can\'t install directly, give me the exact steps to do it myself.\nDon\'t sign in to or configure anything yet — just install.')
                            + _note('Gemini will ask permission to run commands — say yes. This may take a few minutes.')
                    },
                    {
                        title: "You're Ready!",
                        content: '<h2>Step 7: You\'re Ready!</h2>'
                            + '<p>Your setup is complete:</p>'
                            + _check(['VS Code installed', 'Gemini connected', 'Project folder ready', 'Developer tools installed'])
                            + _tip('Gemini is extremely fast at generating code and completely free. Don\'t hesitate to ask for big changes — regenerating is quick.')
                    }
                ]
            }
        };

        function renderSetupGuide(key, step) {
            var guide = SETUP_GUIDES[key];
            step = step || 0;
            var lastStep = guide.steps.length - 1;
            var s = guide.steps[step];
            var html = '';

            // Header — always visible
            html += '<div class="path-picker">';
            html += '<h1>' + guide.name + '</h1>';
            html += '<p class="path-picker-subtitle">' + guide.subtitle + '</p>';
            html += '</div>';

            // Step content
            html += s.content;

            if (step < lastStep) {
                // ── Regular step: back/forward buttons ──
                html += '<div style="display:flex; justify-content:center; align-items:center; gap:12px; padding:24px 0 0;">';
                if (step > 0) {
                    html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px; background:var(--surface-color); color:var(--text-muted); border:1px solid var(--border-color);" onclick="event.preventDefault(); renderSetupGuide(\'' + key + '\', ' + (step - 1) + '); window.scrollTo({top:0,behavior:\'smooth\'});">← Back</a>';
                }
                html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px;" onclick="event.preventDefault(); renderSetupGuide(\'' + key + '\', ' + (step + 1) + '); window.scrollTo({top:0,behavior:\'smooth\'});">' + guide.steps[step + 1].title + ' →</a>';
                html += '</div>';
            } else {
                // ── Last step: back button + navigation cards ──
                html += '<div style="display:flex; justify-content:center; padding:8px 0 24px;">';
                html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px; background:var(--surface-color); color:var(--text-muted); border:1px solid var(--border-color);" onclick="event.preventDefault(); renderSetupGuide(\'' + key + '\', ' + (step - 1) + '); window.scrollTo({top:0,behavior:\'smooth\'});">← Back</a>';
                html += '</div>';

                html += '<div class="path-picker-grid">';
                html += '<div class="path-card" onclick="loadRoute(\'pick-your-path\')" tabindex="0" role="button">';
                html += '<div class="path-card-icon">🛤️</div>';
                html += '<div class="path-card-name">Back to Pick Your Path</div>';
                html += '<div class="path-card-desc">Explore other setup options</div>';
                html += '</div>';
                html += '<div class="path-card" onclick="loadRoute(\'group-project\')" tabindex="0" role="button">';
                html += '<div class="path-card-icon">🚀</div>';
                html += '<div class="path-card-name">Start the Group Project</div>';
                html += '<div class="path-card-desc">Jump into the hands-on group build</div>';
                html += '</div>';
                html += '</div>';
            }

            contentDiv.innerHTML = html;
            addCardKeyboardSupport();
            addCopyButtons();
        }

        // ── Group Project Renderer ───────────────────────────────────
        const GROUP_PROJECT_OPTIONS = [
            { letter: 'A', name: 'Personality Quiz', icon: '🧠', desc: '"Would You Rather" quiz with personality types, progress bar, and animations' },
            { letter: 'B', name: 'Portfolio Page', icon: '🎨', desc: 'Personal portfolio with hero, projects, skills, and contact sections' },
            { letter: 'C', name: 'Browser Game', icon: '🎮', desc: 'Reaction-time game with scoreboard, difficulty levels, and visual feedback' },
            { letter: 'D', name: 'Your Own Idea', icon: '💡', desc: 'Write your own prompt for any single-page project — a tool, game, or visualizer' },
        ];

        function renderGroupProject(step) {
            step = step || 0;
            var html = '';
            var nav = function(back, fwd, fwdLabel) {
                var n = '<div style="display:flex; justify-content:center; align-items:center; gap:12px; padding:24px 0 0;">';
                if (back !== null) n += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px; background:var(--surface-color); color:var(--text-muted); border:1px solid var(--border-color);" onclick="event.preventDefault(); renderGroupProject(' + back + '); window.scrollTo({top:0,behavior:\'smooth\'});">← Back</a>';
                if (fwd !== null) n += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px;" onclick="event.preventDefault(); renderGroupProject(' + fwd + '); window.scrollTo({top:0,behavior:\'smooth\'});">' + fwdLabel + ' →</a>';
                n += '</div>';
                return n;
            };

            // Header — always visible
            html += '<div class="path-picker">';
            html += '<h1>Group Project</h1>';
            html += '<p class="path-picker-subtitle">Build a real project together using the vibe coding workflow: prompt, test, iterate, commit.</p>';
            html += '</div>';

            if (step === 0) {
                // ── Step 1: Open Your AI Tool ──
                html += '<h2>Step 1: Open Your AI Tool</h2>';
                html += '<p>Open the AI tool you set up during installation:</p>';
                html += '<div class="path-picker-grid" style="margin:20px 0;">';
                var tools = [
                    { icon: '🤝', name: 'Claude Desktop', desc: 'Launch the app, switch to Cowork mode, point it at your project folder' },
                    { icon: '🧪', name: 'Google AI Studio', desc: 'Open <a href="https://aistudio.google.com/" target="_blank">aistudio.google.com</a> in your browser' },
                    { icon: '💻', name: 'Claude Code', desc: 'Click the Claude icon in the VS Code editor toolbar' },
                    { icon: '✨', name: 'Gemini CLI', desc: 'Open a terminal in VS Code and type <code>gemini</code>' },
                    { icon: '💬', name: 'Browser AI', desc: 'Open your preferred AI chat and have a text editor ready' },
                ];
                tools.forEach(function(t) {
                    html += '<div class="path-card" style="cursor:default; text-align:center;">';
                    html += '<div class="path-card-icon">' + t.icon + '</div>';
                    html += '<div class="path-card-name">' + t.name + '</div>';
                    html += '<div class="path-card-desc">' + t.desc + '</div>';
                    html += '</div>';
                });
                html += '</div>';
                html += _note('<strong>Using a desktop or IDE tool?</strong> Make sure it\'s pointed at your project folder — that\'s where the AI will create files.<br><br><strong>Using a browser AI?</strong> You\'ll copy code from the chat and paste it into files manually. Have a text editor open and ready.');
                html += nav(null, 1, 'Pick a Project');

            } else if (step === 1) {
                // ── Step 2: Pick a Project & Write Your First Prompt ──
                html += '<h2>Step 2: Pick a Project &amp; Write Your First Prompt</h2>';
                html += '<p>Pick one of the project options below and paste the prompt into your AI tool. Feel free to tweak it — change the theme, swap details, make it yours.</p>';
                html += '<div class="path-picker-grid" style="margin:20px 0;">';
                GROUP_PROJECT_OPTIONS.forEach(function(opt) {
                    html += '<div class="path-card" style="cursor:default; text-align:center;">';
                    html += '<div class="path-card-icon">' + opt.icon + '</div>';
                    html += '<div class="path-card-name">Option ' + opt.letter + ': ' + opt.name + '</div>';
                    html += '<div class="path-card-desc">' + opt.desc + '</div>';
                    html += '</div>';
                });
                html += '</div>';

                html += '<h3>Option A: "Would You Rather" Personality Quiz</h3>';
                html += _term('Create a single HTML file for a "Would You Rather" personality quiz. Include:\n- A fun, colorful design with animations\n- 8 "would you rather" questions with two choices each (e.g., "Would you rather explore a deep cave or climb a tall mountain?")\n- Track the user\'s choices and calculate a personality type at the end\n- Show 4 possible personality types with fun descriptions and emoji\n- Include a progress bar showing how far through the quiz they are\n- Make it mobile-friendly');

                html += '<h3>Option B: Personal Portfolio / Landing Page</h3>';
                html += _term('Create a single HTML file for a personal portfolio page. Include:\n- A hero section with my name, a short bio, and a profile image placeholder\n- A section showcasing 3-4 projects (use placeholder content)\n- A skills or interests section with visual tags or icons\n- A contact section with links (email, GitHub, LinkedIn — use placeholder URLs)\n- Smooth scroll navigation between sections\n- A clean, modern design with good typography — make it mobile-friendly');

                html += '<h3>Option C: Simple Browser Game</h3>';
                html += _term('Create a single HTML file for a simple reaction-time game. Include:\n- A start screen with instructions\n- The game: a shape appears at a random time and position, the player clicks it as fast as they can\n- Track and display their reaction time in milliseconds\n- Keep a running scoreboard of their best 5 times\n- Add difficulty levels (easy = bigger shape and longer wait, hard = smaller and faster)\n- Fun visual feedback on click (animations, color changes)\n- Make it mobile-friendly');

                html += '<h3>Option D: Pick Your Own</h3>';
                html += '<p>Have a different idea? Go for it. Write your own prompt describing a single-page project — a tool, a game, a visualizer, anything. As long as it produces a single HTML file, the rest of the steps work the same.</p>';
                html += _tip('Be specific about what the user sees and does. Include details about the design (colors, layout, animations). Ask for mobile-friendly. Start simple — you\'ll iterate and add features in later steps.');
                html += nav(0, 2, 'Get the Code Into a File');

            } else if (step === 2) {
                // ── Step 3: Get the Code Into a File ──
                html += '<h2>Step 3: Get the Code Into a File</h2>';
                html += '<p>This step depends on which tool you\'re using:</p>';
                html += _note('<strong>Claude Desktop / Cowork mode:</strong> Claude will create the file directly in your project folder. Check that it saved an HTML file — you should see something like <code>index.html</code> appear.');
                html += _note('<strong>Claude Code / Gemini CLI:</strong> The AI will create the file in your open project. You\'ll see it appear in VS Code\'s file explorer on the left side.');
                html += _note('<strong>Browser AI (Claude.ai, ChatGPT, Gemini, AI Studio):</strong> Copy the entire code block the AI generated. Open your text editor, paste it in, and save it as <code>index.html</code> in your project folder.');
                html += '<p style="margin-top:16px;">If the AI generated multiple files, that\'s fine — just make sure you save all of them in the same folder.</p>';
                html += nav(1, 3, 'Open in Browser');

            } else if (step === 3) {
                // ── Step 4: Open in Browser ──
                html += '<h2>Step 4: Open in Browser — See It Work!</h2>';
                html += '<ol class="step-num-list">';
                html += '<li>Find the HTML file in your project folder (<code>index.html</code> or whatever the AI named it)</li>';
                html += '<li>Double-click it to open in your browser</li>';
                html += '<li>Try the whole thing — click through every feature and see how it works</li>';
                html += '</ol>';
                html += '<p style="margin-top:16px;">How does it look? Take a moment to note anything you\'d want to change:</p>';
                html += '<ul style="margin:8px 0 16px 20px; line-height:1.8;">';
                html += '<li>Does the layout look good?</li>';
                html += '<li>Do interactions feel smooth?</li>';
                html += '<li>Is anything missing or broken?</li>';
                html += '<li>What would make it better?</li>';
                html += '</ul>';
                html += _tip('Something looks wrong or doesn\'t work? That\'s not a failure — that\'s the workflow. You now have something specific to tell the AI to fix. Identifying problems and describing them clearly is the core skill of vibe coding.');
                html += nav(2, 4, 'Polish the Design');

            } else if (step === 4) {
                // ── Step 5: Iterate #1 — Polish the Design ──
                html += '<h2>Step 5: Iterate #1 — Polish the Design</h2>';
                html += '<p>Time to improve. Go back to your AI tool and paste a prompt like this:</p>';
                html += _term('Make the project look more polished:\n- Add smooth transitions and animations\n- Improve the color scheme and typography\n- Make buttons and interactions more satisfying (hover effects, click feedback)\n- Add subtle visual details that make it feel professional');
                html += '<p style="margin-top:16px;">After the AI updates the code:</p>';
                html += '<ol class="step-num-list">';
                html += '<li><strong>Save the file</strong> (or let your AI tool save it)</li>';
                html += '<li><strong>Refresh your browser</strong> to see the changes</li>';
                html += '<li><strong>Test the whole thing again</strong> — make sure nothing broke</li>';
                html += '</ol>';
                html += '<p style="margin-top:16px;">Does it look better? Tell the AI what you like ("the transitions are great") and what to change ("the colors are too bright, tone it down"). Be specific — the more precise your feedback, the better the result.</p>';
                html += _note('Browser AI users: Copy the updated code and replace the contents of your HTML file entirely. Save and refresh.');
                html += nav(3, 5, 'Add More Content');

            } else if (step === 5) {
                // ── Step 6: Iterate #2 — Add More Content ──
                html += '<h2>Step 6: Iterate #2 — Add More Content</h2>';
                html += '<p>Let\'s make the project more substantial. Tell the AI to add more content and depth. Some ideas depending on your project:</p>';
                html += '<ul style="margin:8px 0 16px 20px; line-height:1.8;">';
                html += '<li><strong>Quiz:</strong> "Expand to 10 questions, add 6 personality types with detailed descriptions and a trait breakdown"</li>';
                html += '<li><strong>Portfolio:</strong> "Add a testimonials section, a timeline of experience, and smooth parallax scrolling"</li>';
                html += '<li><strong>Game:</strong> "Add a countdown mode, particle effects on click, and a high score leaderboard"</li>';
                html += '<li><strong>Your own:</strong> "Add more features, content, or sections — make it feel complete"</li>';
                html += '</ul>';
                html += _term('Add more content and depth to the project:\n- Expand the main feature with more detail and variety\n- Add at least one new section or feature\n- Include more visual polish (icons, illustrations, or decorative elements)\n- Make the overall experience feel more complete and satisfying');
                html += '<p style="margin-top:16px;">Save, refresh, test. Go through the whole thing again. If anything feels off, tell the AI exactly what to change.</p>';
                html += nav(4, 6, 'Introduce Git');

            } else if (step === 6) {
                // ── Step 7: Introduce Git ──
                html += '<h2>Step 7: Introduce Git — Save Your Progress</h2>';
                html += '<p>You now have a working project that you like. Before we change anything else, let\'s save this checkpoint.</p>';
                html += '<p style="margin-top:12px;"><strong>Git</strong> creates save points (called <strong>commits</strong>) in your project\'s history. If you ever break something, you can go back to a working version. Think of it as a save file in a video game.</p>';
                html += _note('<strong>Claude Code / Gemini CLI users:</strong> Tell your AI:<br>' + _term('Initialize a git repository in this folder and create an initial commit with all my files. Use the message "Working project with polished design"'));
                html += _note('<strong>Claude Desktop / AI Studio users:</strong> If your tool supports running terminal commands, ask it to initialize Git. Otherwise, skip Git steps for now — you can learn it later from the <a href="#" onclick="event.preventDefault(); loadRoute(\'Git for Beginners.md\');">Git for Beginners</a> guide.');
                html += _note('<strong>Browser AI users:</strong> Open a terminal in your project folder and run:<br>' + _term('git init\ngit add .\ngit commit -m "Working project with polished design"') + 'If you don\'t have Git installed or aren\'t comfortable with the terminal, skip this for now.');
                html += _tip('<strong>Optional: Visualize with SourceTree</strong> — If you installed <a href="https://www.sourcetreeapp.com/" target="_blank">SourceTree</a>, open it and add your project folder. You\'ll see your first commit — a snapshot of everything you\'ve built so far.');
                html += nav(5, 7, 'Add a Share Feature');

            } else if (step === 7) {
                // ── Step 8: Iterate #3 — Add a Share Feature ──
                html += '<h2>Step 8: Iterate #3 — Add a Share Feature</h2>';
                html += '<p>Let\'s add a way to share or save progress. Tell the AI something like:</p>';
                html += _term('Add a share/save feature:\n- Add a "Copy Link" or "Share" button that copies a summary to clipboard\n- Add a "Start Over" or "Reset" button\n- Save the user\'s state in localStorage so it persists when they return');
                html += '<p style="margin-top:16px;">Save, refresh, test. Try the full flow:</p>';
                html += '<ol class="step-num-list">';
                html += '<li>Use the project from start to finish</li>';
                html += '<li>Try the share/copy feature — paste somewhere to verify it works</li>';
                html += '<li>Try the reset button</li>';
                html += '<li>Close the browser tab, reopen the file — does it remember your state?</li>';
                html += '</ol>';
                html += nav(6, 8, 'Commit Again');

            } else if (step === 8) {
                // ── Step 9: Commit Again ──
                html += '<h2>Step 9: Commit Again</h2>';
                html += '<p>Time for another save point. You\'ve added a significant feature — lock it in.</p>';
                html += _note('<strong>Claude Code / Gemini CLI users:</strong><br>' + _term('Commit my changes with the message "Add share feature and localStorage"'));
                html += _note('<strong>Terminal users:</strong><br>' + _term('git add .\ngit commit -m "Add share feature and localStorage"'));
                html += _tip('<strong>SourceTree users:</strong> Open SourceTree and look at your commit history. You now have two commits — two snapshots. Click on the first one to see what the code looked like before the share feature. This is the power of Git: you can always go back.');
                html += nav(7, 9, 'Make It Yours');

            } else if (step === 9) {
                // ── Step 10: Make It Yours ──
                html += '<h2>Step 10: Make It Yours</h2>';
                html += '<p>This is your project now. Spend the next few minutes customizing it however you want:</p>';
                html += '<div class="path-picker-grid" style="margin:20px 0;">';
                var ideas = [
                    { icon: '🎨', name: 'Change the Theme', desc: 'Dark mode, retro, neon, pastel, brutalist, minimalist' },
                    { icon: '✍️', name: 'Add Your Content', desc: 'Write your own copy, add personal touches' },
                    { icon: '🖼️', name: 'Add Visuals', desc: 'Images, GIFs, illustrations, or background art' },
                    { icon: '🔊', name: 'Add Audio', desc: 'Background music or sound effects' },
                ];
                ideas.forEach(function(d) {
                    html += '<div class="path-card" style="cursor:default; text-align:center;">';
                    html += '<div class="path-card-icon">' + d.icon + '</div>';
                    html += '<div class="path-card-name">' + d.name + '</div>';
                    html += '<div class="path-card-desc">' + d.desc + '</div>';
                    html += '</div>';
                });
                html += '</div>';
                html += '<p>Prompt your AI with whatever changes you want. There\'s no wrong answer here.</p>';
                html += '<p style="margin-top:12px;">When you\'re happy with the result, make another commit:</p>';
                html += _note('<strong>Claude Code / Gemini CLI users:</strong><br>' + _term('Commit my changes with a message describing what I customized'));
                html += _note('<strong>Terminal users:</strong><br>' + _term('git add .\ngit commit -m "Customize project with [your changes here]"'));
                html += nav(8, 10, 'Show &amp; Tell');

            } else {
                // ── Step 11: Show & Tell ──
                html += '<h2>Step 11: Show &amp; Tell</h2>';
                html += '<p>Open your project in the browser and show it to the group!</p>';
                html += '<h3>Things to share:</h3>';
                html += '<ul style="margin:8px 0 20px 20px; line-height:1.8;">';
                html += '<li>Walk through your project — show what it does and how it works</li>';
                html += '<li>What did you customize? What makes yours unique?</li>';
                html += '<li>What was surprising about the process?</li>';
                html += '<li>Did you run into any issues? How did you solve them?</li>';
                html += '</ul>';

                html += '<h3>The Build Cycle</h3>';
                html += '<p style="margin-bottom:16px;">Everything you just did follows the same four-step pattern:</p>';
                html += '<div class="path-picker-grid" style="margin-bottom:24px;">';
                var cycle = [
                    { icon: '💬', name: 'Prompt', desc: 'Describe what you want to the AI' },
                    { icon: '🧪', name: 'Test', desc: 'Open the file in your browser and try it' },
                    { icon: '🔄', name: 'Iterate', desc: 'Tell the AI what to fix or improve' },
                    { icon: '💾', name: 'Commit', desc: 'Save a checkpoint with Git' },
                ];
                cycle.forEach(function(c) {
                    html += '<div class="path-card" style="cursor:default; text-align:center;">';
                    html += '<div class="path-card-icon">' + c.icon + '</div>';
                    html += '<div class="path-card-name">' + c.name + '</div>';
                    html += '<div class="path-card-desc">' + c.desc + '</div>';
                    html += '</div>';
                });
                html += '</div>';

                html += '<p>This is the vibe coding workflow. It works for a simple single-page project and it works for a full web application. The projects get bigger, but the cycle stays the same.</p>';

                // Back button
                html += '<div style="display:flex; justify-content:center; padding:16px 0 24px;">';
                html += '<a href="#" class="step-link-btn" style="font-size:1.05em; padding:10px 28px; background:var(--surface-color); color:var(--text-muted); border:1px solid var(--border-color);" onclick="event.preventDefault(); renderGroupProject(9); window.scrollTo({top:0,behavior:\'smooth\'});">← Back</a>';
                html += '</div>';

                // What's Next nav cards
                html += '<h3>What\'s Next?</h3>';
                html += '<div class="path-picker-grid">';
                var nextSteps = [
                    { icon: '🧠', name: 'Vibe Coding Techniques', desc: 'Prompting strategies and core techniques', route: 'Vibe Coding Techniques.md' },
                    { icon: '🚀', name: 'Solo Project Guide', desc: 'Project ideas, Git, GitHub, and the build cycle', route: 'Solo Project Guide.md' },
                    { icon: '🔥', name: 'Firebase & Deployment', desc: 'Deploy your project to a real URL', route: 'Firebase %26 Deployment.md' },
                    { icon: '⚡', name: 'Advanced Techniques', desc: 'Agents, skills, MCP servers, and more', route: 'Advanced Techniques.md' },
                ];
                nextSteps.forEach(function(ns) {
                    html += '<div class="path-card" onclick="loadRoute(\'' + ns.route + '\')" tabindex="0" role="button">';
                    html += '<div class="path-card-icon">' + ns.icon + '</div>';
                    html += '<div class="path-card-name">' + ns.name + '</div>';
                    html += '<div class="path-card-desc">' + ns.desc + '</div>';
                    html += '</div>';
                });
                html += '</div>';
            }

            contentDiv.innerHTML = html;
            addCardKeyboardSupport();
            addCopyButtons();
        }

        function resetWizardState() {
            if (wizardActive) {
                wizardActive = false;
                document.getElementById('wizard-toggle').classList.remove('active');
                document.getElementById('wizard-toggle').querySelector('span').textContent = 'Step-by-Step';
                document.getElementById('wizard-bar').classList.remove('active');
            }
            wizardSteps = [];
            wizardCurrentStep = 0;
            document.getElementById('wizard-toggle').style.display = 'none';
        }

        // ── Markdown Loading & Rendering ──────────────────────────────
        async function loadMarkdown(filePath, scrollToId) {
            // Special custom routes
            const customRoutes = {
                'welcome': renderWelcome,
                'what-is-vibe-coding': renderWhatIsVibeCoding,
                'what-youll-learn': renderWhatYoullLearn,
                'example-projects': renderExampleProjects,
                'pick-your-path': renderPickYourPath,
                'setup-beginner': renderBeginnerQuickStart,
                'setup-claude-desktop': function() { renderSetupGuide('setup-claude-desktop'); },
                'setup-google-ai-studio': function() { renderSetupGuide('setup-google-ai-studio'); },
                'setup-claude-code': function() { renderSetupGuide('setup-claude-code'); },
                'setup-gemini-cli': function() { renderSetupGuide('setup-gemini-cli'); },
                'group-project': function() { renderGroupProject(); },
            };

            if (customRoutes[filePath]) {
                currentFile = filePath;
                window.location.hash = encodeURIComponent(filePath);
                loadingDiv.style.display = 'none';
                resetWizardState();
                customRoutes[filePath]();
                var fileEntry = AVAILABLE_FILES.find(function(f) { return f.path === filePath; });
                if (fileEntry && fileEntry.autoWizard) {
                    addCopyButtons();
                    parseWizardSteps();
                }
                updateDocNav(filePath);
                updateSidebarDocsActive();
                return;
            }

            resetWizardState();

            currentFile = filePath;
            loadingDiv.style.display = 'block';
            contentDiv.innerHTML = '';

            window.location.hash = encodeURIComponent(filePath);

            try {
                const response = await fetch(filePath);

                if (!response.ok) {
                    throw new Error(`Failed to load ${filePath} (${response.status})`);
                }

                const text = await response.text();
                renderMarkdown(text);
                updateDocNav(filePath);
                updateSidebarDocsActive();
                loadingDiv.style.display = 'none';

                if (scrollToId) {
                    expandAndScrollTo(scrollToId);
                }

            } catch (error) {
                console.error(error);
                showError(error.message);
                loadingDiv.style.display = 'none';
            }
        }

        function renderMarkdown(markdown) {
            const renderer = {
                heading(text, level, raw, slugger) {
                    if (typeof text === 'object' && text !== null) {
                        const options = text;
                        raw = options.raw;
                        level = options.depth;
                        text = options.text;
                    }

                    const safeText = (raw || text || '').toString();
                    const safeLevel = level || 1;
                    const id = generateHeadingId(safeText);
                    return `<h${safeLevel} id="${id}">${text}</h${safeLevel}>`;
                }
            };

            marked.use({ renderer });
            marked.setOptions({
                gfm: true,
                breaks: true
            });

            contentDiv.innerHTML = marked.parse(markdown);

            // Handle links
            contentDiv.querySelectorAll('a').forEach(link => {
                const href = link.getAttribute('href');
                if (!href) return;

                const hrefLower = href.toLowerCase();
                const isMarkdownFile = hrefLower.endsWith('.md') || hrefLower.endsWith('.markdown');
                const hasMarkdownHash = href.includes('#') && (href.split('#')[1].toLowerCase().endsWith('.md') || href.split('#')[1].toLowerCase().endsWith('.markdown'));
                const mdAnchorMatch = href.match(/^(.+\.md)#(.+)$/i);

                // Check if href matches a known viewer route (non-md paths in FILE_GROUPS)
                const isViewerRoute = AVAILABLE_FILES.some(f => f.path === href);

                const isInternalViewerLink = isViewerRoute || ((isMarkdownFile || hasMarkdownHash || mdAnchorMatch) &&
                    (!href.startsWith('http') || href.includes('workshop.nerktek.com/')));

                if (isInternalViewerLink) {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        let targetPath = href;
                        let scrollToId = null;

                        if (mdAnchorMatch) {
                            targetPath = mdAnchorMatch[1];
                            scrollToId = mdAnchorMatch[2];
                        } else if (href.includes('#')) {
                            targetPath = href.split('#')[1];
                        }

                        const decodedPath = decodeURIComponent(targetPath);
                        loadMarkdown(decodedPath, scrollToId);
                        selector.value = decodedPath;
                    });
                    return;
                }

                if (href.startsWith('http') || href.startsWith('https')) {
                    link.setAttribute('target', '_blank');
                    link.setAttribute('rel', 'noopener noreferrer');
                }

                if (href.startsWith('#')) {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = href.substring(1);
                        if (!expandAndScrollTo(targetId)) {
                            console.warn('Target not found:', targetId);
                        }
                    });
                }
            });

            makeCollapsible();
            enhanceStepContent();
            addCopyButtons();
            updateToggleIcon();
            parseWizardSteps();
        }

        // ── Post-Processor: enhance rendered content ─────────────────
        function enhanceStepContent() {
            // 1. Blockquotes → callout boxes
            contentDiv.querySelectorAll('blockquote').forEach(bq => {
                const inner = bq.innerHTML.trim();
                let variant = null, icon = null;

                if (/^<p>\s*<strong>\s*(Tip|💡)/i.test(inner)) { variant = 'tip'; icon = '💡'; }
                else if (/^<p>\s*<strong>\s*(⚠️|Warning)/i.test(inner)) { variant = 'warning'; icon = '⚠️'; }
                else if (/^<p>\s*<strong>\s*(Note|📝)/i.test(inner)) { variant = 'note'; icon = '📝'; }

                if (variant) {
                    const callout = document.createElement('div');
                    callout.className = 'step-callout ' + variant;
                    // Strip the label from the first <p><strong>Label:</strong>
                    const body = inner.replace(/<p>\s*<strong>\s*(?:Tip|💡|⚠️|Warning|Note|📝)\s*:?\s*<\/strong>\s*/i, '<p>');
                    callout.innerHTML = `<span class="step-callout-icon">${icon}</span><div class="step-callout-body">${body}</div>`;
                    bq.replaceWith(callout);
                }
            });

            // 2. Code blocks → terminal chrome
            contentDiv.querySelectorAll('pre').forEach(pre => {
                // Skip if already wrapped
                if (pre.parentElement && pre.parentElement.classList.contains('step-terminal')) return;
                const code = pre.querySelector('code');
                const langClass = code ? code.className : '';
                const langMatch = langClass.match(/language-(\w+)/);
                const lang = langMatch ? langMatch[1] : 'terminal';

                const wrapper = document.createElement('div');
                wrapper.className = 'step-terminal';
                wrapper.innerHTML = '';
                pre.parentNode.insertBefore(wrapper, pre);
                wrapper.appendChild(pre);
            });

            // 3. Short ordered lists → numbered step lists
            contentDiv.querySelectorAll('ol').forEach(ol => {
                const items = ol.querySelectorAll(':scope > li');
                if (items.length >= 2 && items.length <= 8) {
                    ol.classList.add('step-num-list');
                }
            });

            // 4. CTA links (download, sign up, install)
            const ctaPattern = /\b(download|sign\s*up|install|create\s*account|get\s*started)\b/i;
            contentDiv.querySelectorAll('a[href]').forEach(link => {
                if (link.closest('.step-callout, .step-terminal, .path-picker, .path-card, nav, .top-bar, .doc-nav')) return;
                const text = link.textContent.trim();
                const href = link.getAttribute('href') || '';
                if (ctaPattern.test(text) && href.startsWith('http') && !link.classList.contains('step-link-btn')) {
                    link.classList.add('step-link-btn');
                }
            });

            // 5. Checklist items (✅/❌ markers)
            contentDiv.querySelectorAll('ul').forEach(ul => {
                const items = Array.from(ul.querySelectorAll(':scope > li'));
                const checkItems = items.filter(li => /^[✅❌✓✗]/.test(li.textContent.trim()));
                if (checkItems.length >= items.length * 0.5 && checkItems.length >= 2) {
                    ul.classList.add('step-checklist');
                    items.forEach(li => {
                        const text = li.innerHTML.trim();
                        const match = text.match(/^([✅❌✓✗])\s*/);
                        if (match) {
                            const icon = match[1];
                            const rest = text.slice(match[0].length);
                            li.innerHTML = `<span class="step-checklist-icon">${icon}</span><span>${rest}</span>`;
                        }
                    });
                }
            });
        }

        // ── Collapsible Sections (Feature 2: first H2 open) ──────────
        function makeCollapsible() {
            const headers = contentDiv.querySelectorAll('h2, h3');
            const saved = sectionStates[currentFile];
            let firstH2Found = false;

            headers.forEach(header => {
                const level = parseInt(header.tagName[1]);
                const sectionContent = document.createElement('div');
                sectionContent.className = 'section-content';

                let sibling = header.nextElementSibling;
                while (sibling) {
                    const next = sibling.nextElementSibling;
                    if (/^H[1-6]$/.test(sibling.tagName) && parseInt(sibling.tagName[1]) <= level) break;
                    sectionContent.appendChild(sibling);
                    sibling = next;
                }

                if (sectionContent.children.length > 0) {
                    const id = header.id;
                    // Default: first H2 open, plus table-of-contents and welcome
                    let defaultOpen = true;
                    const isOpen = saved ? (saved[id] !== undefined ? saved[id] : defaultOpen) : defaultOpen;
                    if (!isOpen) {
                        header.classList.add('collapsible-header', 'collapsed');
                        sectionContent.classList.add('collapsed');
                    } else {
                        header.classList.add('collapsible-header');
                    }
                    header.after(sectionContent);
                    header.addEventListener('click', () => {
                        header.classList.toggle('collapsed');
                        sectionContent.classList.toggle('collapsed');
                        if (!sectionStates[currentFile]) sectionStates[currentFile] = {};
                        sectionStates[currentFile][id] = !header.classList.contains('collapsed');
                    });
                }
            });
        }

        // ── Code Block Copy Buttons (Feature 4) ──────────────────────
        function addCopyButtons() {
            contentDiv.querySelectorAll('pre').forEach(pre => {
                const btn = document.createElement('button');
                btn.className = 'code-copy-btn';
                btn.textContent = 'Copy';
                btn.addEventListener('click', async () => {
                    const code = pre.querySelector('code');
                    const text = code ? code.textContent : pre.textContent;
                    try {
                        await navigator.clipboard.writeText(text);
                    } catch {
                        // Fallback for file:// protocol
                        const textarea = document.createElement('textarea');
                        textarea.value = text;
                        textarea.style.position = 'fixed';
                        textarea.style.opacity = '0';
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                    }
                    btn.textContent = 'Copied!';
                    btn.classList.add('copied');
                    setTimeout(() => {
                        btn.textContent = 'Copy';
                        btn.classList.remove('copied');
                    }, 2000);
                });
                pre.appendChild(btn);
            });
        }


        // ── Sidebar Document Navigation ───────────────────────────────
        function buildSidebarDocs() {
            const docsList = document.getElementById('sidebar-docs');
            docsList.innerHTML = '';

            FILE_GROUPS.forEach(group => {
                const label = document.createElement('li');
                label.className = 'sidebar-docs-group-label';
                label.textContent = group.label;
                docsList.appendChild(label);

                group.files.forEach(file => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = '#' + encodeURIComponent(file.path);
                    a.textContent = file.name;
                    a.dataset.path = file.path;
                    if (file.path === currentFile) a.classList.add('active');
                    a.addEventListener('click', (e) => {
                        e.preventDefault();
                        selector.value = file.path;
                        loadMarkdown(file.path);
                        closeMobileSidebar();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    });
                    li.appendChild(a);
                    docsList.appendChild(li);
                });
            });
        }

        function updateSidebarDocsActive() {
            document.querySelectorAll('#sidebar-docs a').forEach(a => {
                a.classList.toggle('active', a.dataset.path === currentFile);
            });
        }

        // ── Mobile Sidebar Drawer ─────────────────────────────────────
        const sidebarEl = document.getElementById('sidebar');
        const tocFab = document.getElementById('toc-fab');
        const sidebarOverlay = document.getElementById('sidebar-overlay');

        function openMobileSidebar() {
            sidebarEl.classList.add('mobile-open');
            sidebarOverlay.classList.add('active');
        }

        function closeMobileSidebar() {
            sidebarEl.classList.remove('mobile-open');
            sidebarOverlay.classList.remove('active');
        }

        tocFab.addEventListener('click', () => {
            if (sidebarEl.classList.contains('mobile-open')) {
                closeMobileSidebar();
            } else {
                openMobileSidebar();
            }
        });

        sidebarOverlay.addEventListener('click', closeMobileSidebar);

        // ── Sidebar Collapse/Expand ─────────────────────────────────
        const sidebarReopen = document.getElementById('sidebar-reopen');

        function toggleSidebar() {
            const collapsed = !sidebarEl.classList.contains('collapsed');
            sidebarEl.classList.toggle('collapsed', collapsed);
            localStorage.setItem('sidebar-collapsed', collapsed ? '1' : '');
        }

        // Restore saved state
        if (localStorage.getItem('sidebar-collapsed') === '1') {
            sidebarEl.classList.add('collapsed');
        }

        // ── Expand & Scroll ───────────────────────────────────────────
        function expandAndScrollTo(targetId) {
            const target = document.getElementById(targetId);
            if (!target) return false;

            let el = target;
            while (el && el !== contentDiv) {
                if (el.classList.contains('section-content') && el.classList.contains('collapsed')) {
                    el.classList.remove('collapsed');
                    const header = el.previousElementSibling;
                    if (header && header.classList.contains('collapsible-header')) {
                        header.classList.remove('collapsed');
                        if (!sectionStates[currentFile]) sectionStates[currentFile] = {};
                        sectionStates[currentFile][header.id] = true;
                    }
                }
                el = el.parentElement;
            }

            if (target.classList.contains('collapsible-header') && target.classList.contains('collapsed')) {
                target.classList.remove('collapsed');
                const sectionContent = target.nextElementSibling;
                if (sectionContent && sectionContent.classList.contains('section-content')) {
                    sectionContent.classList.remove('collapsed');
                }
                if (!sectionStates[currentFile]) sectionStates[currentFile] = {};
                sectionStates[currentFile][targetId] = true;
            }

            target.scrollIntoView({ behavior: 'smooth' });
            return true;
        }

        // ── Toggle All Sections ───────────────────────────────────────
        const expandIcon = '<svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 5l4 4 4-4"/><path d="M4 9l4 4 4-4"/></svg>';
        const collapseIcon = '<svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11l4-4 4 4"/><path d="M4 7l4-4 4 4"/></svg>';

        function toggleAllSections() {
            const allHeaders = contentDiv.querySelectorAll('.collapsible-header');
            const collapsed = contentDiv.querySelectorAll('.collapsible-header.collapsed');
            const shouldExpand = collapsed.length >= allHeaders.length / 2;

            allHeaders.forEach(header => {
                const section = header.nextElementSibling;
                if (shouldExpand) {
                    header.classList.remove('collapsed');
                    if (section && section.classList.contains('section-content')) section.classList.remove('collapsed');
                } else {
                    header.classList.add('collapsed');
                    if (section && section.classList.contains('section-content')) section.classList.add('collapsed');
                }
                if (!sectionStates[currentFile]) sectionStates[currentFile] = {};
                sectionStates[currentFile][header.id] = shouldExpand;
            });

            updateToggleIcon();
        }

        function updateToggleIcon() {
            const btn = document.getElementById('toggle-sections');
            const allHeaders = contentDiv.querySelectorAll('.collapsible-header');
            const collapsed = contentDiv.querySelectorAll('.collapsible-header.collapsed');
            btn.innerHTML = collapsed.length >= allHeaders.length / 2 ? expandIcon : collapseIcon;
        }

        function handleFileSelect(filePath) {
            loadMarkdown(filePath);
        }

        function showError(msg) {
            contentDiv.innerHTML = `
                <div class="error">
                    <h3>Unable to load file</h3>
                    <p>${msg}</p>
                    <p>If you are opening this file directly in a browser (file://), you may need to use a local server or manually upload the file below.</p>
                </div>
                <div class="file-upload">
                    <p>Select <strong>${currentFile}</strong> manually:</p>
                    <input type="file" onchange="handleManualUpload(event)">
                </div>
            `;
        }

        function handleManualUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                renderMarkdown(e.target.result);
            };
            reader.readAsText(file);
        }


        // ── Wizard / Step-by-Step Mode ─────────────────────────────
        let wizardSteps = [];
        let wizardCurrentStep = 0;
        let wizardActive = false;

        function parseWizardSteps() {
            wizardSteps = [];
            const walker = document.createTreeWalker(
                contentDiv,
                NodeFilter.SHOW_COMMENT,
                null
            );

            let inWizard = false;
            let currentStep = null;
            let node;

            while (node = walker.nextNode()) {
                const text = node.textContent.trim();

                if (text === 'wizard-start') {
                    inWizard = true;
                    continue;
                }
                if (text === 'wizard-end') {
                    if (currentStep) wizardSteps.push(currentStep);
                    inWizard = false;
                    currentStep = null;
                    continue;
                }

                if (inWizard && text.startsWith('wizard-step:')) {
                    if (currentStep) wizardSteps.push(currentStep);
                    const parts = text.split('|').map(p => p.trim());
                    const num = parts[0].replace('wizard-step:', '').trim();
                    const title = parts.find(p => p.startsWith('title:'));
                    currentStep = {
                        number: parseInt(num),
                        title: title ? title.replace('title:', '').trim() : 'Step ' + num,
                        startComment: node,
                        elements: []
                    };
                    continue;
                }
            }

            // Now collect DOM elements between each step's comment and the next
            wizardSteps.forEach((step, i) => {
                let el = step.startComment.nextSibling;
                const nextComment = i < wizardSteps.length - 1
                    ? wizardSteps[i + 1].startComment
                    : null;

                while (el) {
                    if (nextComment && el === nextComment) break;
                    if (el.nodeType === Node.COMMENT_NODE) {
                        const t = el.textContent.trim();
                        if (t === 'wizard-end') break;
                    }
                    if (el.nodeType === Node.ELEMENT_NODE) {
                        step.elements.push(el);
                    }
                    el = el.nextSibling;
                }
            });

            // Show/hide wizard toggle button
            const toggleBtn = document.getElementById('wizard-toggle');
            toggleBtn.style.display = wizardSteps.length > 0 ? 'inline-block' : 'none';

            // Auto-enter wizard mode for setup/project pages, or restore saved preference
            if (wizardSteps.length > 0) {
                const fileEntry = AVAILABLE_FILES.find(f => f.path === currentFile);
                const pref = localStorage.getItem('wizardMode_' + currentFile);
                if (fileEntry && fileEntry.autoWizard && pref !== 'false') {
                    enterWizardMode(false);
                } else if (pref === 'true') {
                    enterWizardMode(false);
                }
            }
        }

        function enterWizardMode(savePreference) {
            if (wizardSteps.length === 0) return;
            wizardActive = true;

            document.getElementById('wizard-toggle').classList.add('active');
            document.getElementById('wizard-toggle').querySelector('span').textContent = 'Full Doc';
            document.getElementById('wizard-bar').classList.add('active');

            if (savePreference !== false) {
                localStorage.setItem('wizardMode_' + currentFile, 'true');
            }

            // Build progress track with dots and connectors
            const progress = document.getElementById('wizard-progress');
            progress.innerHTML = '';
            const track = document.createElement('div');
            track.className = 'wizard-progress-track';
            wizardSteps.forEach((step, i) => {
                const dot = document.createElement('span');
                dot.className = 'wizard-dot';
                dot.title = step.title;
                dot.addEventListener('click', () => showWizardStep(i));
                track.appendChild(dot);
                if (i < wizardSteps.length - 1) {
                    const conn = document.createElement('span');
                    conn.className = 'wizard-connector';
                    track.appendChild(conn);
                }
            });
            progress.appendChild(track);

            // Hide ALL elements in content, then show only current step
            const savedStep = parseInt(localStorage.getItem('wizardStep_' + currentFile)) || 0;
            const startStep = Math.min(savedStep, wizardSteps.length - 1);

            // Collect all wizard-region elements and content before/after wizard
            markWizardContent();
            showWizardStep(startStep);
        }

        function markWizardContent() {
            // Find content outside wizard regions and hide it
            const allChildren = Array.from(contentDiv.children);
            let inWizardRegion = false;

            allChildren.forEach(el => {
                // Check preceding comments
                let prev = el.previousSibling;
                while (prev && prev.nodeType === Node.COMMENT_NODE) {
                    if (prev.textContent.trim() === 'wizard-start') inWizardRegion = true;
                    if (prev.textContent.trim() === 'wizard-end') inWizardRegion = false;
                    prev = prev.previousSibling;
                }

                if (!inWizardRegion) {
                    // Content outside wizard — check if it's before or after
                    const isWizardEl = wizardSteps.some(s => s.elements.includes(el));
                    if (!isWizardEl) {
                        el.dataset.wizardHidden = 'true';
                        el.style.display = 'none';
                    }
                }
            });
        }

        function exitWizardMode() {
            wizardActive = false;

            document.getElementById('wizard-toggle').classList.remove('active');
            document.getElementById('wizard-toggle').querySelector('span').textContent = 'Step-by-Step';
            document.getElementById('wizard-bar').classList.remove('active');

            localStorage.setItem('wizardMode_' + currentFile, 'false');

            // Restore all hidden elements
            contentDiv.querySelectorAll('[data-wizard-hidden]').forEach(el => {
                el.style.display = '';
                delete el.dataset.wizardHidden;
            });

            // Show all wizard step elements
            wizardSteps.forEach(step => {
                step.elements.forEach(el => {
                    el.style.display = '';
                });
            });
        }

        function showWizardStep(index) {
            if (index < 0 || index >= wizardSteps.length) return;
            wizardCurrentStep = index;

            localStorage.setItem('wizardStep_' + currentFile, index);

            // Hide all step elements, show current with entrance animation
            wizardSteps.forEach((step, i) => {
                step.elements.forEach(el => {
                    if (i === index) {
                        el.style.display = '';
                        el.classList.remove('wizard-step-enter');
                        void el.offsetWidth; // force reflow
                        el.classList.add('wizard-step-enter');
                        // Expand collapsible sections within current step
                        el.querySelectorAll('.collapsible-header.collapsed').forEach(h => {
                            h.classList.remove('collapsed');
                            const sec = h.nextElementSibling;
                            if (sec && sec.classList.contains('section-content'))
                                sec.classList.remove('collapsed');
                        });
                        if (el.classList.contains('collapsible-header') && el.classList.contains('collapsed')) {
                            el.classList.remove('collapsed');
                            const sec = el.nextElementSibling;
                            if (sec && sec.classList.contains('section-content'))
                                sec.classList.remove('collapsed');
                        }
                    } else {
                        el.style.display = 'none';
                        el.classList.remove('wizard-step-enter');
                    }
                });
            });

            // Update counter with step title
            const stepTitle = wizardSteps[index].title;
            const counter = document.getElementById('wizard-step-counter');
            counter.innerHTML = `<span class="step-number">Step ${index + 1}</span> of ${wizardSteps.length} — ${stepTitle}`;

            // Update dots and connectors
            document.querySelectorAll('#wizard-progress .wizard-dot').forEach((dot, i) => {
                dot.className = 'wizard-dot';
                if (i < index) dot.classList.add('completed');
                if (i === index) dot.classList.add('current');
            });
            document.querySelectorAll('#wizard-progress .wizard-connector').forEach((conn, i) => {
                conn.classList.toggle('filled', i < index);
            });

            // Update nav buttons
            document.getElementById('wizard-prev').disabled = index === 0;
            const nextBtn = document.getElementById('wizard-next');
            if (index === wizardSteps.length - 1) {
                nextBtn.textContent = 'Done ✓';
                nextBtn.disabled = false;
                nextBtn.onclick = () => exitWizardMode();
            } else {
                nextBtn.textContent = 'Next →';
                nextBtn.disabled = false;
                nextBtn.onclick = () => showWizardStep(wizardCurrentStep + 1);
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleWizardMode() {
            if (wizardActive) {
                exitWizardMode();
            } else {
                enterWizardMode();
            }
        }

        // Keyboard navigation for wizard
        document.addEventListener('keydown', (e) => {
            if (!wizardActive) return;
            if (document.activeElement && (document.activeElement.tagName === 'INPUT' ||
                document.activeElement.tagName === 'TEXTAREA' ||
                document.activeElement.tagName === 'SELECT')) return;

            if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                e.preventDefault();
                if (wizardCurrentStep < wizardSteps.length - 1) {
                    showWizardStep(wizardCurrentStep + 1);
                }
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                e.preventDefault();
                if (wizardCurrentStep > 0) {
                    showWizardStep(wizardCurrentStep - 1);
                }
            }
        });

        // ── Back to Top (Feature 7) ──────────────────────────────────
        const backToTopBtn = document.getElementById('back-to-top');

        function initBackToTop() {
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopBtn.classList.add('visible');
                } else {
                    backToTopBtn.classList.remove('visible');
                }
            }, { passive: true });

            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        // ── Hash Navigation ───────────────────────────────────────────
        window.addEventListener('hashchange', () => {
            const newHash = decodeURIComponent(window.location.hash.slice(1));
            if (newHash && newHash !== currentFile) {
                currentFile = newHash;
                selector.value = newHash;
                loadMarkdown(newHash);
            }
        });

        // ── Initialize ───────────────────────────────────────────────
        applyFontSize(getStoredFontSize());

        const hash = window.location.hash.slice(1);
        if (hash) {
            const decodedPath = decodeURIComponent(hash);
            currentFile = decodedPath;
            selector.value = decodedPath;
        }

        buildSidebarDocs();
        loadMarkdown(currentFile);
        initBackToTop();

    </script>
</body>
</html>
